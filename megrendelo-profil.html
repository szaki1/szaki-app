<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>Megrendelő profil – SzakiChat</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">

    <style>
        body {
            background:#f4f4f4;
            margin:0;
            font-family:Arial, sans-serif;
        }

        header {
            background:#007aff;
            color:white;
            padding:16px;
            text-align:center;
            font-size:20px;
            font-weight:bold;
        }

        .box {
            background:white;
            border-radius:12px;
            padding:18px;
            box-shadow:0 2px 10px rgba(0,0,0,0.08);
            margin:14px;
        }

        .infoText {
            padding:10px 0;
            font-size:18px;
            font-weight:bold;
        }

        .btn {
            margin-top:12px;
            padding:12px;
            background:#007aff;
            color:white;
            border:none;
            width:100%;
            font-size:16px;
            border-radius:8px;
            cursor:pointer;
        }

        .btn:hover {
            transform:scale(1.02);
        }
    </style>
</head>

<body>

<header>Megrendelő – Profil</header>

<div class="container">

    <!-- Név -->
    <div class="box">
        <b>Név:</b><br>
        <div id="nameDisplay" class="infoText">Betöltés...</div>
    </div>

    <!-- Szerep -->
    <div class="box">
        <b>Szerep:</b><br>
        <div class="infoText">Megrendelő</div>
    </div>

    <!-- Megosztás -->
    <div class="box">
        <b>Megosztások száma:</b>
        <div id="shareCountBox" class="infoText">0 / 5</div>

        <button class="btn" id="addShareBtn">Megosztottam! (+1)</button>

        <p id="unlockInfo" style="color:#777; margin-top:10px;">
            Elérhetőség küldése: <b style="color:red;">Zárolva</b>
        </p>
    </div>

    <!-- Korábbi beszélgetések -->
    <div class="box">
        <b>Korábbi beszélgetések:</b>
        <p style="color:#777; font-size:14px;">Hamarosan…</p>
    </div>

</div>

<!-- ❤️ Lebegő támogatás -->
<div id="supportFloatingBtn"
     onclick="window.open('https://www.paypal.com/donate/?hosted_button_id=QGU3WXVSCH22A','_blank')">
    <span class="heart">❤️</span> Támogasd a SzakiChat-et
</div>


<script type="module">
/* ============================================================
   FIREBASE IMPORT
============================================================ */
import { auth, db } from "./firebase-config.js";

import {
    onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

import {
    doc,
    getDoc,
    updateDoc
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";


/* ============================================================
   FELHASZNÁLÓ BETÖLTÉSE
============================================================ */
let uid = null;
let shareCount = 0;

onAuthStateChanged(auth, async (user) => {
    if (!user) return window.location.href = "login.html";

    uid = user.uid;

    const ref = doc(db, "users", uid);
    const snap = await getDoc(ref);

    if (!snap.exists()) {
        document.getElementById("nameDisplay").innerText = "Ismeretlen felhasználó";
        return;
    }

    const data = snap.data();

    document.getElementById("nameDisplay").innerText =
        data.name || data.email || "Nincs név";

    shareCount = data.shareCount || 0;
    updateShareUI();
});


/* ============================================================
   MEGOSZTÁS SZÁMLÁLÓ + MENTÉS
============================================================ */
document.getElementById("addShareBtn").onclick = async () => {
    if (shareCount < 5) shareCount++;
    updateShareUI();

    await updateDoc(doc(db, "users", uid), {
        shareCount: shareCount
    });
};


/* ============================================================
   FELÜLET FRISSÍTÉSE
============================================================ */
function updateShareUI() {
    document.getElementById("shareCountBox").innerText = `${shareCount} / 5`;

    if (shareCount >= 5) {
        document.getElementById("unlockInfo").innerHTML =
            "<b style='color:green;'>Feloldva! Küldhetsz telefonszámot a chatben.</b>";
    } else {
        document.getElementById("unlockInfo").innerHTML =
            "Elérhetőség küldése: <b style='color:red;'>Zárolva</b>";
    }
}
</script>

</body>
</html>
