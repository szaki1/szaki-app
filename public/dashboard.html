<!-- dashboard.html â€” SZAKI PROFILOD OLDAL v2.1 -->
<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8" />
<title>Szaki profilod â€“ SzakiChat</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="theme-color" content="#ff9800">
<link rel="manifest" href="/manifest.json">
<link rel="icon" type="image/svg+xml" href="/icon-192.png">


<script type="module">
import { auth, db, onAuthStateChanged, doc, getDoc, updateDoc, collection, query, where, onSnapshot, setPersistence, browserLocalPersistence } from "./firebase-config.js";
import { initNotifications, requestNotificationPermission } from "./notifications.js";

// --- SW UPDATE HANDLING: automatikus reload, ha Ãºj verziÃ³ elÃ©rhetÅ‘ ---
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.addEventListener('controllerchange', function() {
    // Ha Ãºj SW aktivÃ¡lÃ³dik, automatikusan reload
    if (window.__reloadingForSW) return;
    window.__reloadingForSW = true;
    location.reload();
  });


// Ãœzenet a SW-nek, hogy skipWaiting-et hÃ­vjon, ha Ã¼zenetet kap
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.addEventListener('message', event => {
    if (event.data && event.data.type === 'RELOAD_PAGE') {
      location.reload();
    }
  });
}

// ğŸ”’ PERSISTENCE DEBUG
setPersistence(auth, browserLocalPersistence).then(()=>{
  console.log('âœ… Auth persistence: browserLocalPersistence');
}).catch((err)=>{
  console.error('âŒ Auth persistence hiba:', err);
});

const PROF_COLORS = {
  "FestÅ‘": "#FFD54F",
  "BurkolÃ³": "#FF9800",
  "VillanyszerelÅ‘": "#FFC107",
  "VÃ­zszerelÅ‘": "#4FC3F7",
  "GÃ¡zszerelÅ‘": "#EF5350",
  "GyorsÃ©tkeztetÃ©si eladÃ³": "#4CAF50",
  "Ford diagnosztika": "#1976D2"
};

let currentUser = null;
let referralCode = null;

// ğŸ’¬ ÃšJ ÃœZENETEK SZÃMLÃLÃ“ - EGYSZERÅ°
function watchNewMessages(myId, role) {
  const chatsRef = collection(db, "chats");
  const field = role === "szaki" ? "szakiId" : "megrId";
  const unreadField = role === "szaki" ? "unreadCountSzaki" : "unreadCountMegr";

  const q = query(chatsRef, where(field, "==", myId));
  onSnapshot(q, (snapshot) => {
    let total = 0;
    snapshot.forEach(chatDoc => {
      const data = chatDoc.data() || {};
      total += data[unreadField] || 0;
    });

    console.log("âœ… SZÃMLÃLÃ“ FRISSÃTÃ‰S:", total, "(field:", unreadField, ")");

    const btn = document.getElementById("inboxBtn");
    if (btn) {
      btn.textContent = total > 0 ? `ğŸ“¥ BejÃ¶vÅ‘ Ã¼zenetek: ${total}` : "ğŸ“¥ BejÃ¶vÅ‘ Ã¼zenetek";
      console.log("âœ… Gomb frissÃ­tve:", btn.textContent);
    } else {
      console.error("âŒ Gomb nem talÃ¡lhatÃ³!");
    }
  }, (err) => {
    console.error('âŒ watchNewMessages onSnapshot hiba:', err);
  });
}

// â³ FIREBASE AUTH STATE - helyes user betÃ¶ltÃ©s
onAuthStateChanged(auth, async (user) => {
  if (!user) {
    location.replace("index.html");
    return;
  }
  const userDoc = await getDoc(doc(db, "users", user.uid));
  if (!userDoc.exists() || userDoc.data().role !== "szaki") {
    location.replace("index.html");
    return;
  }
  const userData = userDoc.data();
  if (!userData.profilKitoltve) {
    location.replace("szaki-profil-kitoltes.html");
    return;
  }
  const prof = userData.szakma || "ismeretlen";
  const header = document.querySelector("header");
  if (header) {
    header.style.background = PROF_COLORS[prof] || "#ff9800";
  }
  const loginInfoEl = document.getElementById("loginInfo");
  // Update the login info element with the user's profession
  if (loginInfoEl) {
    loginInfoEl.textContent = `BelÃ©pve: ${prof.charAt(0).toUpperCase() + prof.slice(1)}`;
  } else {
    console.error("âŒ loginInfo element not found!");
  }
  // ğŸ”‘ ADMIN GOMB MEGJELENÃTÃ‰SE
  if (userData.email === "chisnyan@gmail.com") {
    const adminBtn = document.getElementById("adminBtn");
    if (adminBtn) adminBtn.style.display = "block";
  }
  // ğŸ”” Ã‰RTESÃTÃ‰SEK INICIALIZÃLÃSA
  initNotifications();
  // ğŸ’¬ SZÃMLÃLÃ“ INDÃTÃSA (role alapjÃ¡n)
  watchNewMessages(user.uid, userData.role);
  //  Ã‰RTESÃTÃ‰SI POPUP MEGJELENÃTÃ‰SE (ha mÃ©g nem engedÃ©lyezve)
  if (Notification.permission === "default") {
    setTimeout(() => {
      showNotificationPrompt();
    }, 1000);
  }
  // ğŸ REFERRAL KÃ“D GENERÃLÃS/BETÃ–LTÃ‰S
  if (!userData.referralCode) {
    referralCode = user.uid.substring(0, 8).toUpperCase();
    await updateDoc(doc(db, "users", user.uid), {
      referralCode: referralCode,
      referralCount: 0
    });
  } else {
    referralCode = userData.referralCode;
  }
  console.log("ğŸ”‘ Referral kÃ³d:", referralCode);
	// Referral link megjelenÃ­tÃ©s - AZONNAL
	const referralLink = `https://szakichat.hu/register-szaki.html?ref=${referralCode}`;
	// PrÃ³bÃ¡ljuk meg tÃ¶bbszÃ¶r is, ha nem sikerÃ¼l elsÅ‘re
	if (!setReferralLink(referralLink)) {
		setTimeout(() => {
			if (!setReferralLink(referralLink)) {
				console.error("âŒ Referral link could not be set after retries.");
			}
		}, 500);
	}
});

function setReferralLink(referralLink) {
  const referralLinkEl = document.getElementById("referralLink");
  if (referralLinkEl) {
    referralLinkEl.value = referralLink;
    console.log("âœ… Referral link beÃ¡llÃ­tva:", referralLink);
    return true;
  } else {
    console.error("âŒ referralLink elem nem talÃ¡lhatÃ³!");
    return false;
  }
}

// ElsÅ‘ prÃ³bÃ¡lkozÃ¡s azonnal (userData feldolgozÃ¡sakor hÃ­vd!):
// if (!setReferralLink(referralLink)) {
//   setTimeout(() => {
//     if (!setReferralLink(referralLink)) {
//       setTimeout(() => setReferralLink(referralLink), 500);
//     }
//   }, 100);
// }


window.copyReferralLink = function() {
  const linkEl = document.getElementById("referralLink");
  if (!linkEl) {
    alert("âŒ Link elem nem talÃ¡lhatÃ³!");
    return;
  }
  const link = linkEl.value;
  if (!link || link === "BetÃ¶ltÃ©s...") {
    alert("âŒ Link mÃ©g nem tÃ¶ltÅ‘dÃ¶tt be!");
    return;
  }
  navigator.clipboard.writeText(link);
  alert("âœ… Link mÃ¡solva a vÃ¡gÃ³lapra!");
}

window.shareFacebook = function() {
  const url = encodeURIComponent("https://szakichat.hu");
  window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank', 'width=600,height=400');
}

// ğŸ“¸ SCREENSHOT FELTÃ–LTÃ‰S Ã‰S AI ELLENÅRZÃ‰S
window.uploadScreenshot = async function() {
  const fileInput = document.getElementById("screenshotInput");
  const statusEl = document.getElementById("screenshotStatus");
  
  if (!fileInput.files || fileInput.files.length === 0) {
    statusEl.innerHTML = '<span style="color:#f44336">âŒ Nincs kivÃ¡lasztva kÃ©p!</span>';
    return;
  }
  
  const file = fileInput.files[0];
  
  // FÃ¡jl mÃ©ret ellenÅ‘rzÃ©s (max 5MB)
  if (file.size > 5 * 1024 * 1024) {
    statusEl.innerHTML = '<span style="color:#f44336">âŒ A kÃ©p tÃºl nagy! Max 5MB!</span>';
    return;
  }
  
  statusEl.innerHTML = '<span style="color:#ff9800">â³ KÃ©p feltÃ¶ltÃ©se Ã©s AI ellenÅ‘rzÃ©s...</span>';
  
  try {
    // KÃ©p base64-re konvertÃ¡lÃ¡s
    const base64 = await fileToBase64(file);
    const base64Data = base64.split(',')[1]; // Remove data:image/...;base64, prefix
    
    // AI ellenÅ‘rzÃ©s Gemini Vision API-val
    const isValid = await checkImageWithAI(base64Data);
    
    if (isValid.valid) {
      // âœ… AUTOMATIKUS KIEMELÃ‰S BEÃLLÃTÃSA
      await activateFeaturedStatus();
      
      statusEl.innerHTML = '<span style="color:#4caf50">âœ… SIKERES! ValÃ³di munka fotÃ³! +3 nap KIEMELT stÃ¡tusz aktivÃ¡lva!</span>';
      
      // FrissÃ­tÃ©s megjelenÃ­tÃ©se
      setTimeout(() => {
        location.reload();
      }, 2000);
    } else {
      statusEl.innerHTML = `<span style="color:#f44336">âŒ ${isValid.reason || 'Nem munka fotÃ³! KÃ©rlek valÃ³di burkolÃ¡s/festÃ©s/szerelÃ©s fotÃ³t tÃ¶lts fel!'}</span>`;
    }
  } catch (err) {
    console.error("Screenshot upload error:", err);
    statusEl.innerHTML = '<span style="color:#f44336">âŒ Hiba tÃ¶rtÃ©nt! PrÃ³bÃ¡ld Ãºjra!</span>';
  }
}

// BASE64 KONVERZIÃ“
function fileToBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

// AI KÃ‰PELLENÅRZÃ‰S GEMINI VISION API-VAL
// âš ï¸ BIZTONSÃGI FIGYELMEZTETÃ‰S: Ez az API kulcs PUBLIKUS!
// JAVASOLT: Backend proxy endpointot kÃ©szÃ­teni Cloud Functions-ben
// IDEIGLENES MEGOLDÃS: Google Cloud Console-ban korlÃ¡tozd a kulcsot:
//   - API restrictions: csak Generative Language API
//   - Application restrictions: HTTP referrers (szakichat-ai.web.app/*)
async function checkImageWithAI(base64ImageData) {
  const GEMINI_API_KEY = "AIzaSyCRvuIN8UZtCIsXIMSp0qZolgvkHWYPm-M";
  const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`;
  
  const prompt = `
EllenÅ‘rizd ezt a kÃ©pet! Facebook megosztÃ¡si kÃ©pernyÅ‘kÃ©p-e?

KERESS:
- "SzakiChat" vagy "szakichat" szÃ¶veg
- Facebook felÃ¼let (likes, comments, share gombok)
- MegosztÃ¡si aktivitÃ¡s

VÃLASZOLJ JSON FORMÃTUMBAN:
{
  "valid": true/false,
  "reason": "rÃ¶vid indoklÃ¡s magyarul"
}

FONTOS:
- Ha lÃ¡tszik Facebook Ã‰S SzakiChat â†’ valid: true
- Ha nem Facebook megosztÃ¡s â†’ valid: false
- Add meg az okot magyarul!
`;
  
  try {
    const response = await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        contents: [{
          parts: [
            { text: prompt },
            {
              inline_data: {
                mime_type: "image/jpeg",
                data: base64ImageData
              }
            }
          ]
        }]
      })
    });
    
    if (!response.ok) {
      throw new Error("Gemini API hiba");
    }
    
    const data = await response.json();
    const aiText = data.candidates?.[0]?.content?.parts?.[0]?.text || "";
    
    // JSON kivonÃ¡sa a vÃ¡laszbÃ³l
    const jsonMatch = aiText.match(/\{[\s\S]*\}/);
    if (jsonMatch) {
      return JSON.parse(jsonMatch[0]);
    }
    
    // Fallback: ha az AI "facebook" Ã©s "szakichat" szÃ³t tartalmaz
    const lowerText = aiText.toLowerCase();
    if ((lowerText.includes("facebook") || lowerText.includes("megosztÃ¡")) && lowerText.includes("szaki")) {
      return { valid: true, reason: "AI megerÅ‘sÃ­tette a Facebook megosztÃ¡st" };
    }
    
    return { valid: false, reason: "AI nem ismerte fel Facebook megosztÃ¡snak" };
    
  } catch (err) {
    console.error("AI image check error:", err);
    // Fallback: ha API hiba van, engedÃ©lyezzÃ¼k (ne blokkolja a felhasznÃ¡lÃ³t)
    return { valid: true, reason: "AI ellenÅ‘rzÃ©s sikertelen, automatikusan engedÃ©lyezve" };
  }
}

// KIEMELT STÃTUSZ AKTIVÃLÃSA (3 NAP)
async function activateFeaturedStatus() {
  if (!currentUser) return;
  
  const now = new Date();
  const featuredUntil = new Date(now.getTime() + 3 * 24 * 60 * 60 * 1000); // +3 nap
  
  await updateDoc(doc(db, "users", currentUser.uid), {
    featured: true,
    featuredUntil: featuredUntil,
    lastScreenshotUpload: now
  });
}

window.enableNotifications = async function() {
  const hasPermission = await requestNotificationPermission();
  const statusEl = document.getElementById("notificationStatus");
  const btnEl = document.getElementById("enableNotifications");
  
  if (hasPermission) {
    if (statusEl) statusEl.textContent = "âœ… Ã‰rtesÃ­tÃ©sek engedÃ©lyezve!";
    if (btnEl) {
      btnEl.disabled = true;
      btnEl.textContent = "âœ… EngedÃ©lyezve";
    }
  } else {
    if (statusEl) statusEl.textContent = "âŒ EngedÃ©ly megtagadva";
  }
}

// Ã‰rtesÃ­tÃ©si stÃ¡tusz ellenÅ‘rzÃ©se oldal betÃ¶ltÃ©skor

function updateUIWithUserData(userData, user) {
  // FejlÃ©c szakma
  const prof = userData.szakma || "ismeretlen";
  console.log("[DEBUG] Szakma Firestore-bÃ³l:", prof);
  const header = document.querySelector("header");
  if (header) {
    header.style.background = PROF_COLORS[prof] || "#ff9800";
  } else {
    console.warn("[DEBUG] header elem nem talÃ¡lhatÃ³!");
  }
  const loginInfoEl = document.getElementById("loginInfo");
  if (loginInfoEl) {
    loginInfoEl.textContent = `BelÃ©pve: ${prof.charAt(0).toUpperCase() + prof.slice(1)}`;
    console.log("[DEBUG] loginInfo frissÃ­tve:", loginInfoEl.textContent);
  } else {
    console.warn("[DEBUG] loginInfo elem nem talÃ¡lhatÃ³!");
  }
  // Referral kÃ³d Ã©s link
  let referralCode = userData.referralCode;
  if (!referralCode) {
    referralCode = user.uid.substring(0, 8).toUpperCase();
    updateDoc(doc(db, "users", user.uid), {
      referralCode: referralCode,
      referralCount: 0
    });
  }
  const referralLink = `https://szakichat.hu/register-szaki.html?ref=${referralCode}`;
  const referralLinkEl = document.getElementById("referralLink");
  if (referralLinkEl) {
    referralLinkEl.value = referralLink;
    console.log("[DEBUG] Referral link beÃ¡llÃ­tva:", referralLink);
  } else {
    console.warn("[DEBUG] referralLink elem nem talÃ¡lhatÃ³!");
  }
  // Statisztika
  const referralCount = userData.referralCount || 0;
  const featuredUntil = userData.featuredUntil?.toDate?.() || null;
  const now = new Date();
  let featuredText = "Jelenleg nincs kiemelÃ©s";
  if (userData.featured && featuredUntil && featuredUntil > now) {
    const daysLeft = Math.ceil((featuredUntil - now) / (1000 * 60 * 60 * 24));
    featuredText = `â­ KIEMELT (mÃ©g ${daysLeft} nap)`;
  }
  const statsEl = document.getElementById("referralStats");
  if (statsEl) {
    statsEl.innerHTML = `
      <div>ğŸ‘¥ AjÃ¡nlott regisztrÃ¡ciÃ³k: <strong>${referralCount}</strong></div>
      <div style="margin-top:6px">${featuredText}</div>
    `;
  } else {
    console.warn("âš ï¸ referralStats elem nem talÃ¡lhatÃ³");
  }
  // Admin gomb
  if (userData.email === "chisnyan@gmail.com") {
    const adminBtn = document.getElementById("adminBtn");
    if (adminBtn) adminBtn.style.display = "block";
  }
  // Ã‰rtesÃ­tÃ©sek gomb inicializÃ¡lÃ¡s
  if (typeof initNotifications === "function") {
    initNotifications();
    console.log("[DEBUG] initNotifications meghÃ­vva");
  } else {
    console.warn("[DEBUG] initNotifications nem elÃ©rhetÅ‘!");
  }
  // Hang gomb Ã¡llapot frissÃ­tÃ©s (ha van ilyen logika)
  if (typeof updateNotificationSoundButton === "function") {
    updateNotificationSoundButton();
  }
}

document.addEventListener("DOMContentLoaded", () => {
  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      location.replace("index.html");
      return;
    }
    const userDoc = await getDoc(doc(db, "users", user.uid));
    if (!userDoc.exists() || userDoc.data().role !== "szaki") {
      location.replace("index.html");
      return;
    }
    const userData = userDoc.data();
    if (!userData.profilKitoltve) {
      location.replace("szaki-profil-kitoltes.html");
      return;
    }
    updateUIWithUserData(userData, user);
    // Inbox szÃ¡mlÃ¡lÃ³, stb. csak ezutÃ¡n
    if (typeof watchNewMessages === "function") {
      watchNewMessages(user.uid);
    }
    // Ã‰rtesÃ­tÃ©si popup, ha kell
    if (Notification.permission === "default") {
      setTimeout(() => {
        if (typeof showNotificationPrompt === "function") showNotificationPrompt();
      }, 1000);
    }
  });
});
  const currentState = localStorage.getItem('notificationSound') !== 'false'; // alapbÃ³l BE
  const newState = !currentState;
  localStorage.setItem('notificationSound', newState);
  updateSoundButtonState();
  
  if (newState) {
    alert('ğŸ”Š CsipogÃ³ hang BEKAPCSOLVA');
  } else {
    alert('ğŸ”‡ CsipogÃ³ hang KIKAPCSOLVA (csak rezgÃ©s)');
  }
}

function updateSoundButtonState() {
  const soundEnabled = localStorage.getItem('notificationSound') !== 'false';
  const btn = document.getElementById('toggleSound');
  if (btn) {
    if (soundEnabled) {
      btn.textContent = 'ğŸ”Š Hang: BE';
      btn.style.background = '#4caf50';
    } else {
      btn.textContent = 'ğŸ”‡ Hang: KI';
      btn.style.background = '#9e9e9e';
    }
  }
}

// Ã‰rtesÃ­tÃ©si prompt megjelenÃ­tÃ©se
function showNotificationPrompt() {
  const modal = document.createElement('div');
  modal.style.cssText = `
    position:fixed;top:0;left:0;right:0;bottom:0;
    background:rgba(0,0,0,0.7);z-index:999999;
    display:flex;align-items:center;justify-content:center;
  `;
  
  const box = document.createElement('div');
  box.style.cssText = `
    background:#fff;padding:32px;border-radius:16px;
    max-width:400px;width:90%;box-shadow:0 8px 32px rgba(0,0,0,0.3);
    text-align:center;
  `;
  
  box.innerHTML = `
    <div style="font-size:48px;margin-bottom:16px">ğŸ””</div>
    <h2 style="margin:0 0 16px 0;color:#ff9800">Ã‰rtesÃ­tÃ©sek engedÃ©lyezÃ©se?</h2>
    <p style="color:#666;font-size:14px;line-height:1.6">
      Kapsz Ã©rtesÃ­tÃ©st:<br>
      â€¢ ğŸ’¬ Ãšj Ã¼zenet Ã©rkezÃ©sekor<br>
      â€¢ â­ Ãšj Ã©rtÃ©kelÃ©srÅ‘l<br>
      â€¢ â° KiemelÃ©s lejÃ¡rata elÅ‘tt
    </p>
    <button id="allowNotif" style="width:100%;padding:14px;margin-top:16px;background:#4caf50;color:#fff;border:none;border-radius:8px;font-size:16px;font-weight:bold;cursor:pointer">
      âœ… EngedÃ©lyezem
    </button>
    <button id="denyNotif" style="width:100%;padding:12px;margin-top:8px;background:#fff;color:#666;border:1px solid #ddd;border-radius:8px;font-size:14px;cursor:pointer">
      TalÃ¡n kÃ©sÅ‘bb
    </button>
  `;
  
  modal.appendChild(box);
  document.body.appendChild(modal);
  
  document.getElementById('allowNotif').onclick = async () => {
    const hasPermission = await requestNotificationPermission();
    if (hasPermission) {
      alert('âœ… Ã‰rtesÃ­tÃ©sek engedÃ©lyezve!');
    }
    modal.remove();
  };
  
  document.getElementById('denyNotif').onclick = () => {
    modal.remove();
  };
}

// ğŸ“± PWA TELEPÃTÃ‰S
let deferredPrompt;

window.addEventListener('beforeinstallprompt', (e) => {
  console.log('ğŸ“± PWA telepÃ­thetÅ‘!');
  e.preventDefault();
  deferredPrompt = e;
  
  // Mutasd a telepÃ­tÃ©s gombot
  const installBtn = document.getElementById('installBtn');
  if (installBtn) {
    installBtn.style.display = 'block';
  }
});

window.installPWA = async function() {
  if (!deferredPrompt) {
    alert('Az app mÃ¡r telepÃ­tve van vagy nem telepÃ­thetÅ‘ ezen az eszkÃ¶zÃ¶n.');
    return;
  }
  
  deferredPrompt.prompt();
  const { outcome } = await deferredPrompt.userChoice;
  
  if (outcome === 'accepted') {
    console.log('âœ… PWA telepÃ­tve');
    alert('âœ… App sikeresen telepÃ­tve a kezdÅ‘kÃ©pernyÅ‘re!');
  } else {
    console.log('âŒ PWA telepÃ­tÃ©s elutasÃ­tva');
  }
  
  deferredPrompt = null;
  document.getElementById('installBtn').style.display = 'none';
};

document.getElementById("enableNotifications").addEventListener("click", async () => {
  const hasPermission = await requestNotificationPermission();
  if (hasPermission) {
    initNotifications();
    document.getElementById("notificationStatus").textContent = "âœ… Ã‰rtesÃ­tÃ©sek engedÃ©lyezve!";
  } else {
    document.getElementById("notificationStatus").textContent = "âŒ Ã‰rtesÃ­tÃ©sek nem engedÃ©lyezettek!";
  }
});
</script>

<style>
body{margin:0;font-family:Arial,sans-serif;background:#f5f5f5}
header{
  background:#ff9800;color:#fff;
  padding:8px 12px 6px 12px;
  display:flex;align-items:center;gap:10px;
  min-height:44px;
}
header .title{font-weight:bold;font-size:17px;margin:0;}
header .spacer{flex:1}
#loginInfo{font-weight:bold;font-size:14px;margin:0 8px 0 0;white-space:nowrap;min-width:120px;text-align:right;}
.logout{background:#fff;color:#000;border:none;padding:6px 12px;border-radius:8px;cursor:pointer;font-weight:bold;font-size:14px;margin-left:0;}
.wrap{padding:10px 8px}
/* Gombok Ã©s szekciÃ³k kÃ¶zÃ¶tti sorkÃ¶z minimalizÃ¡lÃ¡sa */
.main-btns{margin:18px 0 0 0 !important;display:flex;justify-content:center;gap:12px;}
.main-content{text-align:center;margin-top:18px !important;}
.main-content h2{margin:0 0 10px 0 !important;font-size:22px;}
.main-content button{margin:8px auto 0 auto !important;}
/* Referral szekciÃ³, Ã©rtesÃ­tÃ©sek, statisztika: kisebb padding, margin */
#referralSection{max-width:600px;margin:24px auto 0 auto !important;background:#fff;padding:14px 10px 14px 10px !important;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.08);}
#referralSection > div, #referralSection h3{margin-bottom:10px !important;margin-top:10px !important;}
/* Ã‰rtesÃ­tÃ©sek blokk */
#referralSection > div[style*='background:#fff3cd']{margin-bottom:8px !important;padding:10px 8px !important;}
/* Facebook/screenshot blokk */
#referralSection > div[style*='background:#f0f8ff']{margin-bottom:8px !important;padding:10px 8px !important;}
/* Statisztika blokk */
#referralSection > div[style*='background:#e8f5e9']{padding:10px 8px !important;}
/* Gombok kisebb sorkÃ¶z, kompaktabb */
button{margin-top:0 !important;margin-bottom:0 !important;}

</style>
</head>

<body>

<header>
  <div class="title">ğŸ‘· Szaki â€“ Profilod</div>
  <div class="spacer"></div>
  <div id="loginInfo">BelÃ©pve: â€¦</div>
  <button class="logout" onclick="location.href='logout-szaki.html'">KilÃ©pÃ©s</button>
</header>

<div class="main-btns">
  <button onclick="window.open('https://www.paypal.com/donate/?hosted_button_id=QGU3WXVSCH22A','_blank')"
    style="display:flex;align-items:center;gap:8px;padding:8px 14px;background:linear-gradient(135deg,#2ecc71,#27ae60);color:#fff;border:none;border-radius:24px;font-weight:bold;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,0.10);font-size:15px;">
    ğŸ’° SzÃ¡ndÃ©k
  </button>
  <button onclick="window.open('https://www.paypal.com/donate/?hosted_button_id=QGU3WXVSCH22A','_blank')"
    style="background:transparent;border:none;box-shadow:none;cursor:pointer;padding:0;width:38px;height:38px;display:flex;align-items:center;justify-content:center;">
    <span style="font-size:28px; color:#ff2d55; position:relative;">â¤ï¸
      <span style="position:absolute; left:0; right:0; top:0; bottom:0; display:flex; align-items:center; justify-content:center; color:#fff; font-size:13px; font-weight:bold; pointer-events:none;">A</span>
    </span>
  </button>
</div>
  <!-- ...existing code... -->
  <div class="main-content">
    <h2>Ãœdv a Szaki Profilodon!</h2>
    <button id="inboxBtn" onclick="location.href='szaki-inbox.html'" 
            style="padding:12px 18px;font-size:16px;background:#ff9800;color:#fff;border:none;border-radius:10px;cursor:pointer;font-weight:bold;display:block;width:100%;max-width:260px;">
      ğŸ“¥ BejÃ¶vÅ‘ Ã¼zenetek
    </button>
    <button onclick="location.href='szaki-profil-kitoltes.html'" 
            style="padding:9px 15px;font-size:15px;background:#fff;color:#ff9800;border:2px solid #ff9800;border-radius:10px;cursor:pointer;font-weight:bold;display:block;width:100%;max-width:260px;">
      âš™ï¸ Profil szerkesztÃ©se
    </button>
    <!-- ADMIN GOMB (csak chisnyan@gmail.com lÃ¡tja) -->
    <button id="adminBtn" onclick="location.href='admin.html'" 
            style="display:none;padding:9px 15px;font-size:15px;background:#6c757d;color:#fff;border:none;border-radius:10px;cursor:pointer;font-weight:bold;width:100%;max-width:260px;">
      ğŸ”’ BelÃ©p ADMIN
    </button>
    <!-- PWA TELEPÃTÃ‰S GOMB -->
    <button id="installBtn" onclick="installPWA()" 
            style="display:none;padding:9px 15px;font-size:15px;background:#4CAF50;color:#fff;border:none;border-radius:10px;cursor:pointer;font-weight:bold;width:100%;max-width:260px;">
      ğŸ“± TelepÃ­tsd az appot
    </button>
  </div>

  <!-- REFERRAL/MEGOSZTÃS SZEKCIÃ“ -->
  <div id="referralSection" style="max-width:600px;margin:40px auto;background:#fff;padding:24px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.08)">
    
    <!-- Ã‰rtesÃ­tÃ©sek beÃ¡llÃ­tÃ¡sa -->
    <div style="margin-bottom:20px;padding:16px;background:#fff3cd;border-radius:8px;border:1px solid #ffc107">
      <strong>ğŸ”” Ã‰rtesÃ­tÃ©sek:</strong>
      <p style="font-size:13px;color:#856404;margin:8px 0">
        Kapsz Ã©rtesÃ­tÃ©st Ãºj Ã¼zenetrÅ‘l, Ã©rtÃ©kelÃ©srÅ‘l Ã©s kiemelÃ©s lejÃ¡rat elÅ‘tt!
      </p>
      <button id="enableNotifications" style="padding:10px 20px;background:#ffc107;color:#000;border:none;border-radius:6px;cursor:pointer;font-weight:bold;margin-right:10px">
        ğŸ”” Ã‰rtesÃ­tÃ©sek engedÃ©lyezÃ©se
      </button>
      <button id="toggleSound" style="padding:10px 20px;background:#4caf50;color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:bold">
        ğŸ”Š Hang: BE
      </button>
      <span id="notificationStatus" style="margin-left:10px;color:#28a745"></span>
    </div>

    <!-- INGYEN KIEMELÃ‰S (Ã©rtesÃ­tÃ©sek utÃ¡n) -->
    <div style="display:flex;align-items:center;gap:16px;margin:10px 0 0 0;flex-wrap:wrap;">
      <h3 style="margin:0;color:#ff9800;white-space:nowrap;font-size:18px;">ğŸ Ingyen kiemelÃ©s!</h3>
      <div style="display:flex;align-items:center;gap:8px;background:#f9f9f9;padding:8px 10px;border-radius:8px;">
        <strong style="font-size:15px;">ğŸ“¤ AjÃ¡nlÃ³ linked:</strong>
        <input type="text" id="referralLink" readonly style="padding:6px 8px;background:#fff;border:1px solid #ddd;border-radius:6px;font-family:monospace;width:180px;box-sizing:border-box;font-size:13px" placeholder="BetÃ¶ltÃ©s...">
        <button onclick="copyReferralLink()" style="padding:6px 10px;background:#4caf50;color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:bold;font-size:13px;">
          ğŸ“‹ MÃ¡solÃ¡s
        </button>
      </div>
      <span style="font-size:12px;color:#666;margin-left:8px;">ğŸ’¡ Minden regisztrÃ¡ciÃ³ ezen keresztÃ¼l â†’ <strong>+3 nap KIEMELT</strong> stÃ¡tusz!</span>
    </div>

    <!-- Facebook megosztÃ¡s + Screenshot feltÃ¶ltÃ©s -->
    <div style="margin-bottom:20px;padding:16px;background:#f0f8ff;border-radius:8px">
      <strong>ğŸ“± Facebook megosztÃ¡s:</strong>
      <p style="font-size:13px;color:#666;margin:8px 0">
        Oszd meg a SzakiChat-et Facebookon, kÃ©szÃ­ts screenshot-ot a megosztÃ¡srÃ³l, Ã©s tÃ¶ltsd fel!
      </p>
      <button onclick="shareFacebook()" style="padding:10px 20px;background:#1877f2;color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:bold;margin-bottom:15px;width:100%">
        ğŸ“¤ MegosztÃ¡s Facebookon
      </button>
      
      <!-- Screenshot feltÃ¶ltÃ©s a megosztÃ¡srÃ³l -->
      <div style="margin-top:15px;padding:12px;background:#e1f5e1;border:2px solid #4caf50;border-radius:8px">
        <strong>ğŸ“¸ TÃ¶ltsd fel a megosztÃ¡srÃ³l kÃ©szÃ¼lt kÃ©pernyÅ‘kÃ©pet:</strong>
        <p style="font-size:12px;color:#2e7d32;margin:8px 0">
          âœ… Ha az AI megerÅ‘sÃ­ti a Facebook megosztÃ¡st â†’ <strong>+3 nap KIEMELT stÃ¡tusz</strong>!
        </p>
        <input type="file" id="screenshotInput" accept="image/*" style="margin-top:10px;padding:8px;border:1px solid #ccc;border-radius:6px;width:100%;box-sizing:border-box">
        <button onclick="uploadScreenshot()" style="margin-top:10px;padding:10px 20px;background:#4caf50;color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:bold;width:100%">
          ğŸš€ FeltÃ¶ltÃ©s Ã©s AI ellenÅ‘rzÃ©s
        </button>
        <div id="screenshotStatus" style="margin-top:10px;font-size:14px;font-weight:bold"></div>
      </div>
    </div>

    <!-- Statisztika -->
    <div style="padding:16px;background:#e8f5e9;border-radius:8px">
      <strong>ğŸ“Š StatisztikÃ¡d:</strong>
      <div id="referralStats" style="margin-top:10px;font-size:14px"></div>
    </div>
  </div>
</div>

<!-- PRESENCE STUB -->
<script type="module" src="presence.js"></script>

<!-- DONATION GOMB -->


<script src="draggable-buttons.js"></script>
</body>
</html>
