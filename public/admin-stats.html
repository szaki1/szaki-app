<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<title>Admin ‚Äì Statisztika</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body { font-family:Arial; margin:0; background:#f2f2f2; }
header {
    background:#222; color:white; padding:18px;
    text-align:center; font-size:22px;
}
.box {
    max-width:480px; margin:20px auto;
    padding:18px; background:white;
    border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.15);
}
h3 { margin:0 0 10px 0; color:#007aff; }

/* ‚ù§Ô∏è ADOM√ÅNY GOMB */
#supportBtn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background:#ff2d55;
    color:white;
    padding:14px 22px;
    border-radius:40px;
    font-weight:bold;
    cursor:pointer;
    box-shadow:0 4px 12px rgba(0,0,0,0.3);
    z-index:999;
}
</style>
</head>

<body>

<header>Admin ‚Äì Statisztik√°k</header>

<div id="supportBtn"
onclick="window.open('https://www.paypal.com/donate/?hosted_button_id=QGU3WXVSCH22A','_blank')">
‚ù§Ô∏è T√°mogasd a SzakiChat-et
</div>

<div class="box" id="statsBox">Bet√∂lt√©s‚Ä¶</div>

<script type="module">
import { auth, db } from "./firebase-config.js";

import {
    onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

import {
    collection, onSnapshot, doc, getDoc
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const box = document.getElementById("statsBox");

/* =========================================================
   üîí ADMIN ELLEN≈êRZ√âS (k√∂telez≈ë biztons√°gi funkci√≥)
========================================================= */
onAuthStateChanged(auth, async (user) => {

    if (!user) {
        window.location.href = "admin-login.html";
        return;
    }

    const ref = doc(db, "users", user.uid);
    const snap = await getDoc(ref);

    if (!snap.exists() || snap.data().role !== "admin") {
        alert("Nincs admin jogosults√°g!");
        window.location.href = "admin-login.html";
        return;
    }

    // Ha admin ‚Üí statisztika ind√≠that√≥
    loadStats();
});

/* =========================================================
   STATISZTIKA BET√ñLT√âSE REALTIME
========================================================= */
function loadStats() {

    onSnapshot(collection(db, "users"), (snap) => {

        let szakik = 0;
        let megrendelok = 0;
        let online = 0;

        snap.forEach(docu => {
            const d = docu.data();

            // szerepk√∂r alapj√°n sz√°mol√°s
            if (d.role === "szaki") szakik++;
            else megrendelok++;

            // online mez≈ë hi√°ny√°nak kezel√©se
            if (d.online === true) online++;
        });

        box.innerHTML = `
            <h3>Akt√≠v statisztik√°k</h3>
            Szakik sz√°ma: <b>${szakik}</b><br>
            Megrendel≈ëk sz√°ma: <b>${megrendelok}</b><br>
            Online felhaszn√°l√≥k: <b>${online}</b>
        `;
    });
}
</script>

</body>
</html>
