<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<title>Admin ‚Äì Chat megtekint√©s</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body { font-family:Arial; margin:0; background:#f2f2f2; }
header {
    background:#222; color:white; padding:16px;
    font-size:20px; text-align:center; font-weight:bold;
}

.chatBox {
    max-width:700px; margin:20px auto;
    background:white; padding:18px;
    border-radius:12px; box-shadow:0 4px 14px rgba(0,0,0,0.15);
}

.msg {
    padding:10px; margin-bottom:10px;
    border-radius:10px; background:#ececec;
    max-width:80%;
    word-wrap:break-word;
}
.me { background:#c8e0ff; margin-left:auto; }

.msg img {
    max-width:250px;
    border-radius:10px;
    margin-top:6px;
}

/* ‚ù§Ô∏è Donate gomb */
#supportBtn {
    position: fixed;
    bottom: 22px;
    right: 22px;
    background:#ff2d55;
    padding:14px 22px;
    border-radius:40px;
    color:white;
    font-weight:bold;
    cursor:pointer;
    box-shadow:0 4px 12px rgba(0,0,0,0.25);
}
</style>
</head>

<body>

<header>Admin ‚Äì Chat tartalom</header>

<!-- DONATE -->
<div id="supportBtn"
     onclick="window.open('https://www.paypal.com/donate/?hosted_button_id=QGU3WXVSCH22A','_blank')">
    ‚ù§Ô∏è T√°mogasd a SzakiChat-et
</div>

<div class="chatBox" id="chatBox">Bet√∂lt√©s‚Ä¶</div>

<script type="module">
import { auth, db } from "./firebase-config.js";

import {
    onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

import {
    doc, getDoc, onSnapshot
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const params = new URLSearchParams(window.location.search);
const chatID = params.get("chatID");

const chatDiv = document.getElementById("chatBox");

/* ============================================================
   üîí ADMIN ELLEN≈êRZ√âS
============================================================ */
onAuthStateChanged(auth, async (user) => {
    if (!user) return window.location.href = "admin-login.html";

    const snap = await getDoc(doc(db, "users", user.uid));
    if (!snap.exists() || snap.data().role !== "admin") {
        alert("Nincs admin jogosults√°g!");
        window.location.href = "admin-login.html";
        return;
    }

    loadChat();
});

/* ============================================================
   üî• CHAT TARTALOM BET√ñLT√âSE (chats / chatID)
============================================================ */
function loadChat() {

    const chatRef = doc(db, "chats", chatID);

    onSnapshot(chatRef, (snap) => {

        if (!snap.exists()) {
            chatDiv.innerHTML = "Nincs ilyen chat ID.";
            return;
        }

        const data = snap.data();
        const msgs = data.messages || [];

        chatDiv.innerHTML = "";

        msgs.forEach(m => {

            // K√©p √ºzenet
            if (m.type === "img") {
                chatDiv.innerHTML += `
                    <div class="msg ${m.from === 'admin' ? 'me' : ''}">
                        <b>${m.from}</b><br>
                        <img src="${m.url}">
                    </div>
                `;
                return;
            }

            // Norm√°l √ºzenet
            chatDiv.innerHTML += `
                <div class="msg ${m.from === 'admin' ? 'me' : ''}">
                    <b>${m.from}</b><br>
                    ${m.text}
                </div>
            `;
        });

        if (msgs.length === 0) {
            chatDiv.innerHTML = "A chat m√©g √ºres.";
        }
    });
}

</script>

</body>
</html>
