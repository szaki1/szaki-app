<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>Szaki Panel ‚Äì SzakiChat</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">

    <style>
        body {
            background:#f4f4f4;
            margin:0;
            font-family:Arial, sans-serif;
        }

        header {
            background:#007aff;
            color:white;
            padding:16px;
            text-align:center;
            font-size:20px;
            font-weight:bold;
        }

        .box {
            background:white;
            padding:18px;
            border-radius:12px;
            margin:14px;
            box-shadow:0 2px 10px rgba(0,0,0,0.08);
        }

        .btn {
            width:100%;
            padding:12px;
            margin-top:14px;
            font-size:16px;
            background:#007aff;
            color:white;
            border:none;
            border-radius:8px;
            cursor:pointer;
        }

        .btn:hover {
            transform:scale(1.02);
        }

        #logoutBtn {
            background:#c00;
        }

        .ads-box {
            text-align:center;
            padding:16px;
            background:white;
            border-radius:12px;
            margin:14px;
            font-size:15px;
            color:#444;
            box-shadow:0 2px 10px rgba(0,0,0,0.08);
        }

        .statusBadge {
            font-weight:bold;
            margin-left:4px;
        }
    </style>
</head>

<body>

<header>SzakiChat ‚Äì Szaki Panel</header>

<div class="container">

    <!-- USER INFO -->
    <div class="box" id="userBox">
        Bet√∂lt√©s‚Ä¶
    </div>

    <!-- ONLINE / OFFLINE -->
    <div class="box">
        <h3>√Ållapot</h3>
        <p><b>Online st√°tusz:</b> <span id="status">‚Äì</span></p>
        <button id="toggleOnline" class="btn">Online v√°lt√°s</button>
    </div>

    <!-- CHAT LISTA -->
    <div class="box">
        <h3>Chat</h3>
        <button onclick="window.location.href='chat-list.html'" class="btn">Chat megnyit√°sa</button>
    </div>

    <!-- REKL√ÅM -->
    <div class="ads-box">
        üî∂ Itt lesznek a hirdet√©sek (Google Ads / c√©ges bannerek)
    </div>

    <!-- KIJELENTKEZ√âS -->
    <button id="logoutBtn" class="btn" style="margin:14px;">Kijelentkez√©s</button>

</div>


<!-- ‚ù§Ô∏è Lebeg≈ë t√°mogat√°s -->
<div id="supportFloatingBtn"
     onclick="window.open('https://www.paypal.com/donate/?hosted_button_id=QGU3WXVSCH22A','_blank')">
    <span class="heart">‚ù§Ô∏è</span> T√°mogasd a SzakiChat-et
</div>


<script type="module">
/* ============================================================
   FIREBASE IMPORT
============================================================ */
import { auth, db } from "./firebase-config.js";

import {
    onAuthStateChanged,
    signOut
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

import {
    doc,
    getDoc,
    updateDoc
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";


/* ============================================================
   USER BET√ñLT√âS
============================================================ */
let uid = localStorage.getItem("uid") || null;

if (!uid) {
    window.location.href = "login.html";
}

onAuthStateChanged(auth, async (user) => {
    if (!user) {
        window.location.href = "login.html";
        return;
    }

    uid = user.uid;

    const ref = doc(db, "users", uid);
    const snap = await getDoc(ref);

    if (!snap.exists()) {
        document.getElementById("userBox").innerHTML = "Hiba: nincs felhaszn√°l√≥i adat!";
        return;
    }

    const data = snap.data();

    document.getElementById("userBox").innerHTML = `
        <h3>√údv, ${data.name || data.email}</h3>
        <p><b>Szakma:</b> ${data.szakma || "Nincs megadva"}</p>
    `;

    document.getElementById("status").innerText =
        data.online ? "üü¢ Online" : "‚ö™ Offline";
});


/* ============================================================
   ONLINE / OFFLINE V√ÅLT√ÅS
============================================================ */
document.getElementById("toggleOnline").onclick = async () => {
    const ref = doc(db, "users", uid);
    const snap = await getDoc(ref);
    const act = snap.data().online;

    await updateDoc(ref, { online: !act });

    document.getElementById("status").innerText =
        !act ? "üü¢ Online" : "‚ö™ Offline";
};


/* ============================================================
   KIJELENTKEZ√âS
============================================================ */
document.getElementById("logoutBtn").onclick = async () => {
    if (uid) {
        await updateDoc(doc(db, "users", uid), { online: false });
    }

    await signOut(auth);
    localStorage.clear();

    window.location.href = "login.html";
};
</script>

</body>
</html>
