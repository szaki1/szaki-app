<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>Szaki Panel ‚Äì SzakiChat</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">

    <style>
        header {
            background:#007aff;
            color:white;
            padding:16px;
            font-size:22px;
            text-align:center;
        }

        .container {
            max-width:420px;
            margin:25px auto;
            background:white;
            padding:20px;
            border-radius:12px;
            box-shadow:0 4px 14px rgba(0,0,0,0.08);
        }

        .box {
            margin-bottom:28px;
        }

        .btn {
            width:100%;
            padding:12px;
            background:#007aff;
            border:none;
            color:white;
            font-weight:bold;
            border-radius:8px;
            cursor:pointer;
        }

        .btn:hover { transform:scale(1.03); }

        .ads-box {
            background:#f1f1f1;
            padding:12px;
            text-align:center;
            border-radius:8px;
            color:#888;
            font-size:14px;
            margin-top:18px;
        }

        /* ‚ù§Ô∏è pulz√°l√≥ sz√≠v */
        @keyframes heartbeat {
            0%{transform:scale(1);}
            25%{transform:scale(1.25);}
            40%{transform:scale(1);}
            60%{transform:scale(1.25);}
            100%{transform:scale(1);}
        }
        #supportFloatingBtn {
            position:fixed;
            bottom:22px;
            right:22px;
            background:#ff2d55;
            color:white;
            padding:14px 22px;
            border-radius:40px;
            font-weight:bold;
            cursor:pointer;
            display:flex;
            align-items:center;
            gap:10px;
            box-shadow:0 4px 14px rgba(0,0,0,0.25);
            z-index:9999;
        }
        .heart { animation:heartbeat 1.4s infinite; }
    </style>
</head>

<body>

<header>SzakiChat ‚Äì Szaki Panel</header>

<div class="container">

    <div class="box" id="userBox">
        <div style="text-align:center; padding:10px; color:#777;">Bet√∂lt√©s...</div>
    </div>

    <div class="box">
        <h3>√Ållapot</h3>
        <p><b>Online st√°tusz:</b> <span id="status">‚Äì</span></p>
        <button id="toggleOnline" class="btn">Online √°llapot v√°lt√°sa</button>
    </div>

    <div class="box">
        <h3>Chat</h3>
        <button onclick="window.location.href='chat-list.html'" class="btn">Chat megnyit√°sa</button>
    </div>

    <!-- REKL√ÅMHELY -->
    <div class="ads-box">
        üî∂ Hirdet√©sek helye (automatikus bet√∂lt√©s k√©s≈ëbb)
    </div>

    <button id="logoutBtn" class="btn" style="background:#c00; margin-top:20px;">
        Kijelentkez√©s
    </button>

</div>

<!-- ‚ù§Ô∏è Lebeg≈ë T√°mogat√°s gomb -->
<div id="supportFloatingBtn"
     onclick="window.open('https://www.paypal.com/donate/?hosted_button_id=QGU3WXVSCH22A','_blank')">
    <span class="heart">‚ù§Ô∏è</span> T√°mogasd a SzakiChat-et
</div>


<!-- FIREBASE LOGIKA -->
<script type="module">
import { auth, db } from "./firebase-config.js";

import {
    onAuthStateChanged,
    signOut
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

import {
    doc,
    getDoc,
    updateDoc,
    setDoc
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

let uid = null;
let userData = null;

/* ===============================
   BEL√âP√âS ELLEN≈êRZ√âS + ADAT BET√ñLT√âS
=============================== */
onAuthStateChanged(auth, async (user) => {
    if (!user) {
        window.location.href = "login.html";
        return;
    }

    uid = user.uid;

    const ref = doc(db, "users", uid);
    const snap = await getDoc(ref);

    if (!snap.exists()) {
        // ha nincs user dokumentum, l√©trehozzuk
        await setDoc(ref, {
            email: user.email,
            name: "Ismeretlen",
            role: "szaki",
            online: false
        });
    }

    userData = snap.data();

    // Ha NEM szaki, visszadobjuk
    if (userData.role !== "szaki") {
        window.location.href = "megrendelo-profil.html";
        return;
    }

    document.getElementById("userBox").innerHTML = `
        <h3>√údv, ${userData.name || userData.email}</h3>
        <p><b>Email:</b> ${userData.email}</p>
        <p><b>Szerep:</b> Szaki</p>
    `;

    document.getElementById("status").innerText =
        userData.online ? "üü¢ Online" : "‚ö™ Offline";
});


/* ===============================
   ONLINE / OFFLINE V√ÅLT√ÅS
=============================== */
document.getElementById("toggleOnline").onclick = async () => {
    if (!uid) return;

    const ref = doc(db, "users", uid);
    const snap = await getDoc(ref);
    const current = snap.data().online;

    await updateDoc(ref, { online: !current });

    document.getElementById("status").innerText =
        !current ? "üü¢ Online" : "‚ö™ Offline";
};


/* ===============================
   KIJELENTKEZ√âS
=============================== */
document.getElementById("logoutBtn").onclick = async () => {
    if (uid) {
        await updateDoc(doc(db, "users", uid), { online: false });
    }

    await signOut(auth);
    localStorage.clear();
    window.location.href = "login.html";
};
</script>

</body>
</html>
