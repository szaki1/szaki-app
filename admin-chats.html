<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<title>Admin ‚Äì √ñsszes Chat</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body { font-family:Arial; background:#f2f2f2; margin:0; }
header {
    background:#222; color:white; padding:18px;
    text-align:center; font-size:22px; font-weight:bold;
}

.chatBox {
    max-width:800px; margin:20px auto;
    background:white; padding:18px;
    border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.15);
}

.chatItem {
    padding:12px; border:1px solid #ccc;
    border-radius:10px; margin-bottom:12px;
    cursor:pointer; background:#fafafa;
}
.chatItem:hover { background:#f0f0f0; }

/* ‚ù§Ô∏è Adom√°ny gomb */
#supportBtn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background:#ff2d55;
    color:white;
    padding:14px 22px;
    border-radius:40px;
    font-weight:bold;
    cursor:pointer;
    box-shadow:0 4px 12px rgba(0,0,0,0.3);
    z-index:999;
}
</style>
</head>

<body>

<header>Admin ‚Äì √ñsszes Chat</header>

<!-- ADOM√ÅNY GOMB -->
<div id="supportBtn"
     onclick="window.open('https://www.paypal.com/donate/?hosted_button_id=QGU3WXVSCH22A','_blank')">
    ‚ù§Ô∏è T√°mogasd a SzakiChat-et
</div>

<div class="chatBox" id="chatList">Bet√∂lt√©s‚Ä¶</div>

<script type="module">
import { auth, db } from "./firebase-config.js";

import {
    onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

import {
    collection, onSnapshot, doc, getDoc
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const listDiv = document.getElementById("chatList");

/* ============================================================
   üîí ADMIN ELLEN≈êRZ√âS
============================================================ */
onAuthStateChanged(auth, async (user) => {

    if (!user) {
        window.location.href = "admin-login.html";
        return;
    }

    const ref = doc(db, "users", user.uid);
    const snap = await getDoc(ref);

    if (!snap.exists() || snap.data().role !== "admin") {
        alert("Nincs admin jogosults√°g!");
        window.location.href = "admin-login.html";
        return;
    }

    // Ha admin ‚Üí indul a chat lista
    loadChats();
});

/* ============================================================
   üî• CHAT LISTA BET√ñLT√âSE REALTIME
============================================================ */
function loadChats() {

    onSnapshot(collection(db, "chatSessions"), (snap) => {

        listDiv.innerHTML = "";

        if (snap.empty) {
            listDiv.innerHTML = "M√©g nincs chat.";
            return;
        }

        snap.forEach(docu => {
            const d = docu.data();

            const id = d.chatId || docu.id;
            const lastMsg = d.lastMessage ? d.lastMessage.slice(0, 80) : "-";
            const time = d.lastTime
                ? new Date(d.lastTime.seconds * 1000).toLocaleString()
                : "-";

            listDiv.innerHTML += `
                <div class="chatItem"
                    onclick="window.location.href='admin-chat-view.html?chatID=${id}'">
                    <b>Chat azonos√≠t√≥:</b> ${id}<br>
                    <b>Utols√≥ √ºzenet:</b> ${lastMsg}<br>
                    <b>Id≈ë:</b> ${time}
                </div>
            `;
        });
    });
}

</script>

</body>
</html>
