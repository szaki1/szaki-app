<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8" />
    <title>Új Megrendelő – Szaki-App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body {
            font-family: Arial, sans-serif;
            background:#f5f5f5;
            margin:0;
            padding:0;
        }

        header {
            background:#ff8c00;
            padding:18px;
            color:white;
            text-align:center;
            font-size:22px;
            font-weight:bold;
        }

        .wrap {
            max-width:900px;
            margin:20px auto;
            background:white;
            padding:22px;
            border-radius:12px;
            box-shadow:0 4px 16px rgba(0,0,0,0.08);
        }

        h2 {
            margin:0 0 14px;
            font-size:20px;
            color:#333;
        }

        .mezo {
            margin-bottom:16px;
        }

        label {
            font-weight:bold;
            margin-bottom:4px;
            display:block;
        }

        .kotelezo {
            color:#d32f2f;
            font-weight:normal;
        }

        input, select {
            width:100%;
            padding:10px;
            border-radius:8px;
            border:1px solid #ccc;
            font-size:15px;
        }

        .next-btn {
            width:100%;
            padding:16px;
            border:none;
            border-radius:10px;
            background:#ff8c00;
            color:white;
            font-size:18px;
            font-weight:bold;
            cursor:pointer;
            margin-top:20px;
        }

        .next-btn:disabled {
            opacity:.5;
            cursor:not-allowed;
        }
    </style>
</head>
<body>

<header>Új megrendelés indítása</header>

<div class="wrap">

    <h2>1. Alapadatok</h2>

    <div class="mezo">
        <label>Neved <span class="kotelezo">(kötelező)</span></label>
        <input type="text" id="nev" placeholder="Pl.: Kiss József">
    </div>

    <div class="mezo">
        <label>Telefonszám vagy e-mail <span class="kotelezo">(kötelező)</span></label>
        <input type="text" id="elerhetoseg" placeholder="+36 30 ... vagy email">
    </div>

    <div class="mezo">
        <label>Város / kerület <span class="kotelezo">(kötelező)</span></label>
        <input type="text" id="varos" placeholder="Pl.: Budapest XXI. kerület">
    </div>

    <div class="mezo">
        <label>Keresett szakma <span class="kotelezo">(kötelező)</span></label>
        <select id="szakma"></select>
    </div>

    <button class="next-btn" id="nextBtn" disabled>Tovább a szakik listájához</button>

</div>

<script type="module">

/* ===============================
   FIREBASE
================================ */
import { db } from "./firebase-config.js";
import {
    collection,
    doc,
    setDoc,
    serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";


/* ===============================
   SZAKMALISTA – BŐVÍTVE!
================================ */
const SZAKMAK = [
    "Burkoló",
    "Festő",
    "Villanyszerelő",
    "Gipszkartonszerelő",
    "Kőműves",
    "Vízszerelő",
    "Gázkészülékszerelő",
    "Autószerelő",
    "Asztalos",
    "Épületasztalos",
    "Bútorasztalos",
    "Bútor összeszerelő",
    "Teljes lakásfelújítás"
];

function feltoltSzakmak() {
    const sel = document.getElementById("szakma");
    sel.innerHTML = `<option value="">Válassz szakmát…</option>`;
    SZAKMAK.forEach(s => {
        sel.innerHTML += `<option value="${s}">${s}</option>`;
    });
}

feltoltSzakmak();


/* ===============================
   VALIDÁLÁS
================================ */
const requiredFields = ["nev","elerhetoseg","varos","szakma"];

function checkValid() {
    const ok = requiredFields.every(id => {
        return document.getElementById(id).value.trim() !== "";
    });

    document.getElementById("nextBtn").disabled = !ok;
}

requiredFields.forEach(id => {
    document.getElementById(id).addEventListener("input", checkValid);
});


/* ===============================
   ORDER ID GENERÁLÁSA
================================ */
function generateOrderId() {
    return "ORD-" + Math.random().toString(36).substring(2,9).toUpperCase();
}


/* ===============================
   MEGRENDELÉS MENTÉSE
================================ */
document.getElementById("nextBtn").onclick = async () => {

    const nev = document.getElementById("nev").value.trim();
    const el = document.getElementById("elerhetoseg").value.trim();
    const varos = document.getElementById("varos").value.trim();
    const szakma = document.getElementById("szakma").value.trim();

    /* --- Locals --- */
    localStorage.setItem("mr_nev", nev);
    localStorage.setItem("mr_szakma", szakma);

    /* --- Order ID --- */
    const orderId = generateOrderId();

    /* --- Firestore mentés --- */
    await setDoc(doc(db, "orders", orderId), {
        orderId,
        megrendeloNev: nev,
        elerhetoseg: el,
        varos,
        szakma,
        status: "new",
        createdAt: serverTimestamp()
    });

    /* --- Tovább a szakiválasztó oldalra --- */
    window.location.href =
        `valassz-szakit.html?megrendelonev=${encodeURIComponent(nev)}&szakma=${encodeURIComponent(szakma)}&orderId=${orderId}`;
};

</script>

</body>
</html>
