<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>Bel√©p√©s ‚Äì SzakiChat</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body { margin:0; background:#f2f2f2; font-family:Arial; }
        header {
            background:#007aff; color:white; padding:20px;
            text-align:center; font-size:26px; font-weight:bold;
        }
        .box {
            max-width:450px; margin:40px auto;
            background:white; padding:25px;
            border-radius:14px; box-shadow:0 4px 12px rgba(0,0,0,0.15);
        }
        input {
            width:100%; padding:12px; margin-top:10px;
            border-radius:8px; border:1px solid #ccc;
            font-size:16px; background:#eef5ff;
        }
        button {
            width:100%; padding:14px; margin-top:20px;
            background:#007aff; color:white; border:none;
            border-radius:8px; font-size:18px; font-weight:bold;
            cursor:pointer;
        }
    </style>
</head>

<body>

<header>Bel√©p√©s</header>

<div class="box">
    <input id="email" type="email" placeholder="Email c√≠m">
    <input id="password" type="password" placeholder="Jelsz√≥">
    <button onclick="login()">Bel√©p√©s</button>
</div>

<script type="module">

import { auth, db } from "./firebase-config.js";
import { signInWithEmailAndPassword }
    from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { doc, getDoc }
    from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

window.login = async function () {

    const email = document.getElementById("email").value.trim();
    const pass  = document.getElementById("password").value.trim();

    if (!email || !pass) {
        alert("Add meg az emailt √©s jelsz√≥t!");
        return;
    }

    try {
        // üî• 1) Firebase Auth bel√©p√©s
        const cred = await signInWithEmailAndPassword(auth, email, pass);
        const uid = cred.user.uid;

        // üî• 2) ADMIN? ‚Üí egyb≈ël admin.html (Firestore n√©lk√ºl)
        if (email === "admin@szakichat.hu") {
            window.location.href = "admin.html";
            return;
        }

        // üî• 3) Firestore user profil lek√©r√©se
        const ref = doc(db, "users", uid);
        const snap = await getDoc(ref);

        if (!snap.exists()) {
            alert("Hiba: nincs Firestore profil!");
            return;
        }

        const data = snap.data();
        const role = data.role;

        // üî• 4) Ir√°ny√≠t√°s szerepk√∂r alapj√°n
        if (role === "szaki") {
            window.location.href = "szaki-chat-list.html";
            return;
        }

        if (role === "user") {
            window.location.href = "user-chat-list.html";
            return;
        }

        alert("Ismeretlen szerepk√∂r: " + role);

    } catch (err) {
        alert("Hiba: " + err.message);
    }
};
</script>

</body>
</html>
