<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>Belépés – SzakiChat</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body { margin:0; background:#f2f2f2; font-family:Arial; }
        header {
            background:#007aff; color:white; padding:20px;
            text-align:center; font-size:26px; font-weight:bold;
        }
        .box {
            max-width:450px; margin:40px auto;
            background:white; padding:25px;
            border-radius:14px; box-shadow:0 4px 12px rgba(0,0,0,0.15);
        }
        input {
            width:100%; padding:12px; margin-top:10px;
            border-radius:8px; border:1px solid #ccc;
            font-size:16px; background:#eef5ff;
        }
        button {
            width:100%; padding:14px; margin-top:20px;
            background:#007aff; color:white; border:none;
            border-radius:8px; font-size:18px; font-weight:bold;
            cursor:pointer;
        }
    </style>
</head>

<body>

<header>Belépés</header>

<div class="box">
    <input id="email" type="email" placeholder="Email cím">
    <input id="password" type="password" placeholder="Jelszó">
    <button onclick="login()">Belépés</button>
</div>

<script type="module">

import { auth, db } from "./firebase-config.js";
import { signInWithEmailAndPassword } 
    from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { doc, getDoc } 
    from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

window.login = async function () {

    const email = document.getElementById("email").value.trim();
    const pass  = document.getElementById("password").value.trim();

    if (!email || !pass) {
        alert("Add meg az emailt és jelszót!");
        return;
    }

    try {
        // 1) Firebase Auth belépés
        const cred = await signInWithEmailAndPassword(auth, email, pass);
        const uid = cred.user.uid;

        // *** UID KIÍRATÁS – EZ KELL A DIAGNOSZTIKÁHOZ ***
        alert("Firebase UID: " + uid);

        // 2) Firestore user profil lekérése
        const ref = doc(db, "users", uid);
        const snap = await getDoc(ref);

        if (!snap.exists()) {
            alert("Hiba: nincs Firestore profil!");
            return;
        }

        const data = snap.data();
        const role = data.role;

        // 3) Irányítás szerepkör alapján
        if (role === "admin") {
            window.location.href = "admin.html";
            return;
        }

        if (role === "szaki") {
            window.location.href = "szaki-chat-list.html";
            return;
        }

        if (role === "user" || role === "megrendelő") {
            window.location.href = "user-chat-list.html";
            return;
        }

        alert("Ismeretlen szerepkör: " + role);

    } catch (err) {
        alert("Hiba: " + err.message);
    }
};
</script>

</body>
</html>
