<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>Szakma v√°laszt√°s ‚Äì SzakiChat</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">

    <style>
        header {
            background:#007aff;
            color:white;
            padding:16px;
            font-size:22px;
            text-align:center;
        }

        .container {
            max-width:450px;
            margin:25px auto;
            background:white;
            padding:20px;
            border-radius:12px;
            box-shadow:0 4px 14px rgba(0,0,0,0.08);
        }

        .box {
            margin-bottom:28px;
        }

        .input {
            width:100%;
            padding:12px;
            border-radius:8px;
            border:1px solid #ccc;
            margin-top:6px;
            font-size:16px;
        }

        .btn {
            width:100%;
            padding:12px;
            background:#007aff;
            border:none;
            border-radius:8px;
            color:white;
            font-weight:bold;
            cursor:pointer;
        }

        .btn:disabled {
            background:#999;
            cursor:not-allowed;
        }

        .ads-box {
            background:#f1f1f1;
            padding:14px;
            border-radius:8px;
            text-align:center;
            color:#777;
        }

        /* ‚ù§Ô∏è Pulz√°l√≥ gomb */
        @keyframes heartbeat {
            0%{transform:scale(1);}
            25%{transform:scale(1.25);}
            40%{transform:scale(1);}
            60%{transform:scale(1.25);}
            100%{transform:scale(1);}
        }
        #supportFloatingBtn {
            position:fixed;
            bottom:22px;
            right:22px;
            background:#ff2d55;
            color:white;
            padding:14px 22px;
            border-radius:40px;
            display:flex;
            align-items:center;
            gap:10px;
            font-weight:bold;
            cursor:pointer;
            box-shadow:0 4px 15px rgba(0,0,0,0.25);
        }
        .heart { animation:heartbeat 1.4s infinite; }
    </style>
</head>

<body>

<header>Szakma v√°laszt√°s</header>

<div class="container">

    <div class="box">
        <h3>V√°lassz szakm√°t</h3>
        <p>V√°laszd ki, milyen szakembert keresel.</p>

        <select id="szakma" class="input">
            <option value="">‚Äì V√°lassz szakm√°t ‚Äì</option>
            <option value="Burkol√≥">Burkol√≥</option>
            <option value="Fest≈ë">Fest≈ë</option>
            <option value="Gipszkarton szerel≈ë">Gipszkarton szerel≈ë</option>
            <option value="Villanyszerel≈ë">Villanyszerel≈ë</option>
            <option value="K≈ëm≈±ves">K≈ëm≈±ves</option>
            <option value="V√≠z / G√°z / F≈±t√©s">V√≠z / G√°z / F≈±t√©s</option>
        </select>

        <button id="nextBtn" class="btn" style="margin-top:16px;" disabled>
            Tov√°bb
        </button>
    </div>

    <div class="box" style="background:#fff4e6; padding:14px; border-radius:10px;">
        <b>Az oldal haszn√°lata ingyenes!</b><br><br>
        A szakik el√©rhet≈ës√©g√©nek felold√°s√°hoz oszd meg az oldalt legal√°bb <b>5 helyen</b>.
    </div>

    <div class="ads-box">
        üî∂ Rekl√°m hely ‚Äì Google Ads vagy c√©ges banner
    </div>

</div>

<!-- ‚ù§Ô∏è Lebeg≈ë gomb -->
<div id="supportFloatingBtn"
     onclick="window.open('https://www.paypal.com/donate/?hosted_button_id=QGU3WXVSCH22A','_blank')">
    <span class="heart">‚ù§Ô∏è</span> T√°mogasd a SzakiChat-et
</div>


<script type="module">
/* ============================================
   Firebase import
============================================ */
import { auth, db } from "./firebase-config.js";
import {
    onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import {
    doc,
    updateDoc,
    getDoc
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

/* ============================================
   Bel√©p√©s-ellen≈ërz√©s
============================================ */
let uid = null;
let userData = null;

onAuthStateChanged(auth, async (user) => {
    if (!user) return window.location.href = "login.html";

    uid = user.uid;

    const ref = doc(db, "users", uid);
    const snap = await getDoc(ref);

    if (!snap.exists()) {
        window.location.href = "profil.html";
        return;
    }

    userData = snap.data();

    // Ha szaki pr√≥b√°l itt lenni ‚Üí visszadobjuk
    if (userData.role !== "megrendelo") {
        window.location.href = "szaki-panel.html";
        return;
    }

    loadDefault();
});


/* ============================================
   Funkci√≥: mentett szakma visszat√∂lt√©se
============================================ */
function loadDefault() {
    const szakmaSel = document.getElementById("szakma");

    if (userData.preferredSzakma) {
        szakmaSel.value = userData.preferredSzakma;
        document.getElementById("nextBtn").disabled = false;
    }
}


/* ============================================
   V√°laszt√°s kezel√©se
============================================ */
const szakmaSelect = document.getElementById("szakma");
const nextBtn = document.getElementById("nextBtn");

szakmaSelect.onchange = async () => {
    const value = szakmaSelect.value.trim();

    nextBtn.disabled = value === "";

    if (value) {
        // mentj√ºk Firestore-ba
        await updateDoc(doc(db, "users", uid), {
            preferredSzakma: value
        });
    }
};


/* ============================================
   Tov√°bb gomb
============================================ */
nextBtn.onclick = () => {
    const v = szakmaSelect.value.trim();
    if (!v) return;

    window.location.href =
        "szaki-valasztas.html?szakma=" + encodeURIComponent(v);
};
</script>

</body>
</html>
