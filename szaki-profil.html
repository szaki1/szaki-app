<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>Szakember profil – Szaki-App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body {
            margin: 0; padding: 0;
            font-family: Arial, sans-serif;
            background: #f5f5f5;
        }
        header {
            background: #ff8c00; color: #fff;
            padding: 16px; text-align: center;
            font-size: 20px; font-weight: bold;
        }
        .container {
            max-width: 900px; margin: 0 auto; padding: 16px;
        }
        .card {
            background: #fff; padding: 18px;
            border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
        .name {
            font-size: 24px; font-weight:bold; margin-bottom: 6px;
        }
        .badge {
            display:inline-block; background:#ffe6bf; color:#8a4b00;
            padding:5px 12px; border-radius:999px;
            font-size:12px; margin-bottom:10px;
        }
        .prof {
            font-size:16px; color:#555; margin-bottom:12px;
        }
        .phone {
            margin-top:8px; font-size:15px;
        }
        .phone b { font-weight:bold; }
        .warning {
            color:#c00; font-size:12px; margin-left:4px;
        }
        .buttons {
            margin-top:20px; display:flex; gap:10px;
        }
        .btn {
            flex:1; padding:12px;
            border:none; border-radius:8px; cursor:pointer;
            font-size:15px; font-weight:bold;
        }
        .chat-btn { background:#28a745; color:white; }
        .share-btn { background:#007bff; color:white; }
    </style>
</head>

<body>

<header>Szakember profil</header>

<div class="container">
    <div id="profile" class="card">
        Betöltés…
    </div>
</div>

<script src="szaki-adatok.js"></script>
<script type="module">
    import { getMaskedContact, canRevealRealData } from "./masking.js";

    const params = new URLSearchParams(window.location.search);
    const name = params.get("name") || "";
    const megrendelonev = params.get("megrendelonev") || "Megrendelő";

    const profileBox = document.getElementById("profile");

    // Teljes lista
    const all = window.SzakiAdatok.getAllSzakik();
    const szaki = all.find(s => s.name.toLowerCase() === name.toLowerCase());

    if (!szaki) {
        profileBox.innerHTML =
            `<p>Ez a szakember nem található.</p>`;
        throw new Error("Nincs ilyen szaki");
    }

    // Maszkolt telefon
    const maskedPhone = getMaskedContact(megrendelonev, szaki.phone);
    const canSeeReal = canRevealRealData(megrendelonev);

    // Rang badge
    let badgeText = "";
    if (szaki.isReal) {
        if (szaki.name === "Csabi") badgeText = "KIEMELT SZAKEMBER – Platina rang";
        else badgeText = "Igazolt szakember";
    } else {
        badgeText = "Naptára betáblázva";
    }

    profileBox.innerHTML = `
        <div class="name">${szaki.name}</div>
        <div class="badge">${badgeText}</div>

        <div class="prof">
            ${Array.isArray(szaki.profession) ? szaki.profession.join(", ") : szaki.profession}
        </div>

        <div class="phone">
            <b>Telefon:</b> ${maskedPhone}
            ${!canSeeReal ? `<span class="warning">(5 megosztás után látható)</span>` : ""}
        </div>

        <div class="buttons">
            <button class="btn chat-btn" id="chat-btn">Chat indítása</button>
            <button class="btn share-btn" id="share-btn">Megosztás</button>
        </div>
    `;

    // Chat gomb
    document.getElementById("chat-btn").onclick = () => {
        window.location.href =
            `chat.html?sender=${encodeURIComponent(megrendelonev)}&partner=${encodeURIComponent(szaki.name)}`;
    };

    // Megosztás gomb
    document.getElementById("share-btn").onclick = () => {
        const url = window.location.href;

        navigator.clipboard.writeText(url);
        alert("Link másolva! Oszd meg 5× és megmutatjuk a valós számot!");
    };
</script>

</body>
</html>
