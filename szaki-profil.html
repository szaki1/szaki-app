<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8" />
<title>Szaki profil ‚Äì Szaki-App</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
    body {
        background:#f5f5f5;
        margin:0;
        padding:15px;
        font-family:Arial,sans-serif;
    }

    .box {
        background:white;
        padding:20px;
        max-width:900px;
        margin:0 auto;
        border-radius:12px;
        box-shadow:0 2px 8px rgba(0,0,0,0.08);
    }

    h2 {
        text-align:center;
        margin:0 0 20px;
    }

    .label {
        margin-top:10px;
        color:#555;
        font-size:14px;
    }

    .value {
        font-size:17px;
        margin-bottom:4px;
        font-weight:bold;
    }

    .status-line {
        margin-top:15px;
        padding:10px;
        background:#fff7d6;
        border-left:4px solid #ff8c00;
        border-radius:8px;
        font-size:14px;
    }

    .btn {
        margin-top:20px;
        width:100%;
        background:#ff8c00;
        color:white;
        border:none;
        padding:12px;
        font-size:16px;
        border-radius:8px;
        cursor:pointer;
        font-weight:bold;
    }
</style>
</head>
<body>

<div class="box" id="profile-box">
    <h2>Szaki profil</h2>

    <div class="label">N√©v:</div>
    <div class="value" id="p-name">Bet√∂lt√©s‚Ä¶</div>

    <div class="label">Szakm√°k:</div>
    <div class="value" id="p-prof">Bet√∂lt√©s‚Ä¶</div>

    <div class="label">Telefon:</div>
    <div class="value" id="p-phone">Bet√∂lt√©s‚Ä¶</div>

    <div class="label">Email:</div>
    <div class="value" id="p-email">Bet√∂lt√©s‚Ä¶</div>

    <div class="status-line" id="p-status">
        St√°tusz: Bet√∂lt√©s‚Ä¶
    </div>

    <button class="btn" id="back-btn">Vissza</button>
</div>

<script type="module">

//---------------------------------------------------------
// IMPORTOK
//---------------------------------------------------------
import { app, db } from "./firebase-config.js";
import {
    collection, getDocs
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

import {
    watchUserStatus,
    formatLastActive
} from "./users-status.js";

import "./masking.js";
import "./szaki-adatok.js";

//---------------------------------------------------------
// URL PARAM√âTEREK
//---------------------------------------------------------
const params = new URLSearchParams(window.location.search);
const nameParam = params.get("name");  // profilhoz √°tadott n√©v

// Ha nincs n√©v ‚Üí vissza
if (!nameParam) {
    document.getElementById("profile-box").innerHTML =
        "<p>Hiba: nincs kiv√°lasztott szaki.</p>";
}

//---------------------------------------------------------
// SZAKI ADATOK BET√ñLT√âSE (helyi adatb√°zisb√≥l)
//---------------------------------------------------------
const all = window.SzakiAdatok.getAllSzakik();
const szaki = all.find(s => s.name === nameParam);

document.getElementById("p-name").textContent = szaki?.name || "Ismeretlen";
document.getElementById("p-prof").textContent = Array.isArray(szaki?.profession)
    ? szaki.profession.join(", ")
    : szaki?.profession || "‚Äî";

// MASZKOLT TELEFON + EMAIL
const maskedPhone = window.Mask.phone(szaki?.phone || "");
const maskedEmail = window.Mask.email((szaki?.name || "").toLowerCase().replace(" ","") + "@email.hu");

document.getElementById("p-phone").textContent = maskedPhone;
document.getElementById("p-email").textContent = maskedEmail;

//---------------------------------------------------------
// FIRESTORE FELHASZN√ÅL√ìK (csak ha k√©s≈ëbb b≈ëv√≠t√ºnk emaillel)
//---------------------------------------------------------
const usersRef = collection(db, "users");
const snap = await getDocs(usersRef);

const firestoreUsers = {};
snap.forEach(d => firestoreUsers[d.id] = d.data());

//---------------------------------------------------------
// REALTIME ONLINE ST√ÅTUSZ
//---------------------------------------------------------
const statusEl = document.getElementById("p-status");

watchUserStatus(szaki.name, (data) => {

    if (!data) {
        statusEl.textContent = "St√°tusz: nincs adat";
        return;
    }

    if (data.isOnline) {
        statusEl.textContent = "üü¢ Online";
    } else {
        statusEl.textContent =
            "‚ö™ Utolj√°ra akt√≠v: " + formatLastActive(data.lastActive);
    }
});

//---------------------------------------------------------
// VISSZA
//---------------------------------------------------------
document.getElementById("back-btn").onclick = () => {
    window.history.back();
};

</script>

</body>
</html>
