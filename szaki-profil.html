<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8" />
    <title>Szaki profil – Szaki-App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
        body {
            margin: 0;
            padding: 0;
            background: #f5f5f5;
            font-family: Arial, sans-serif;
        }

        header {
            background: #ff8c00;
            color: white;
            padding: 16px;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 16px;
        }

        .card {
            background: white;
            padding: 16px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }

        .name {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 6px;
        }

        .professions {
            font-size: 15px;
            color: #444;
            margin-bottom: 12px;
        }

        .status-online {
            font-weight: bold;
            color: #28a745;
            margin-bottom: 12px;
        }

        .status-offline {
            font-weight: bold;
            color: #c00;
            margin-bottom: 12px;
        }

        .info-line {
            font-size: 14px;
            margin: 6px 0;
        }

        .btn-chat {
            margin-top: 18px;
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            background: #28a745;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }

        .btn-chat:active {
            transform: translateY(1px);
        }

        .back-btn {
            margin-top: 20px;
            text-align: center;
        }
        .back-btn a {
            color:#007bff;
            text-decoration:none;
            font-size:14px;
        }
    </style>
</head>

<body>

<header>Szaki profil</header>

<div class="container">
    <div id="profile-card" class="card">
        Betöltés…
    </div>

    <div class="back-btn">
        <a href="szaki-profilok.html">◀ Vissza a listához</a>
    </div>
</div>

<script type="module">

    import { db } from "./firebase-config.js";
    import {
        doc,
        getDoc
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    import { markUserOnline } from "./users-status.js";

    // A szaki profil URL: szaki-profil.html?name=Zsolti
    const params = new URLSearchParams(window.location.search);
    const szakiNev = params.get("name");

    const box = document.getElementById("profile-card");

    if (!szakiNev) {
        box.innerHTML = "<p>Hiba: nincs megadva a szaki neve az URL-ben.</p>";
        throw new Error("Nincs name paraméter");
    }

    // Megrendelő online jelölése
    markUserOnline("megrendelo_" + Date.now());

    // ------------------------------
    // SZAKI ADATOK FIRESTORE-BÓL
    // ------------------------------
    async function loadProfile() {

        const ref = doc(db, "szakik", szakiNev);
        const snap = await getDoc(ref);

        if (!snap.exists()) {
            box.innerHTML = `<p>Nincs ilyen szakember: <b>${szakiNev}</b></p>`;
            return;
        }

        const d = snap.data();

        const isOnline = d.online ? "status-online" : "status-offline";
        const onlineText = d.online ? "ONLINE" : "offline";

        box.innerHTML = `
            <div class="name">${d.name}</div>

            <div class="${isOnline}">${onlineText}</div>

            <div class="professions">
                Szakmák: ${d.szakmak.join(", ")}
            </div>

            <div class="info-line"><b>Telefon:</b> ${d.phoneMasked || "***"}</div>
            <div class="info-line"><b>Email:</b> ${d.emailMasked || "***"}</div>

            ${d.note ? `<div class="info-line"><b>Megjegyzés:</b> ${d.note}</div>` : ""}

            ${
                d.holidays
                ? `<div class="info-line"><b>Nyaralás:</b> ${d.holidays.from} – ${d.holidays.to}</div>`
                : ""
            }

            <button class="btn-chat"
                onclick="window.location.href =
                'chat.html?sender=${encodeURIComponent("Megrendelő")}&partner=${encodeURIComponent(d.name)}'">
                Chat indítása
            </button>
        `;
    }

    loadProfile();

</script>

</body>
</html>
