<!-- [1/3 - START] -->
<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8" />
    <title>Munka r√©szletei ‚Äì Szaki-App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f2f2f2;
            margin: 0;
            padding: 30px 10px;
        }

        .wrapper {
            max-width: 900px;
            margin: 0 auto 40px;
            background: #ffffff;
            border-radius: 12px;
            padding: 30px 25px 35px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.06);
        }

        h1 {
            text-align: center;
            margin-top: 0;
            margin-bottom: 6px;
        }

        .alcim {
            text-align: center;
            margin: 0 0 25px;
            color: #666;
        }

        .summary-box {
            background: #fff8e1;
            border-radius: 8px;
            padding: 10px 14px;
            font-size: 14px;
            line-height: 1.4;
            margin-bottom: 22px;
            border: 1px solid #ffe0b2;
        }

        .summary-box strong {
            font-weight: bold;
        }

        .section-title {
            font-size: 18px;
            margin: 18px 0 4px;
            font-weight: bold;
        }

        .section-subtitle {
            font-size: 13px;
            color: #777;
            margin-bottom: 8px;
        }

        textarea,
        input[type="text"],
        input[type="file"],
        select {
            width: 100%;
            box-sizing: border-box;
            border-radius: 6px;
            border: 1px solid #ccc;
            font-size: 14px;
            padding: 10px 12px;
        }

        textarea {
            min-height: 150px;
            resize: vertical;
        }

        .textarea-wrapper {
            position: relative;
        }

        .char-counter {
            position: absolute;
            right: 8px;
            bottom: 6px;
            font-size: 12px;
            color: #999;
        }

        .char-counter.too-short {
            color: #e53935;
            font-weight: bold;
        }

        /* Mikrofon gomb */
        .mic-button {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 32px;
            height: 32px;
            background: #f57c00;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.25);
            color: #fff;
            font-size: 18px;
        }

        .mic-button.active {
            background: #e53935;
        }

        .chips-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 10px 0 8px;
        }

        .chip {
            border-radius: 999px;
            border: 1px solid #ccc;
            padding: 6px 12px;
            font-size: 13px;
            background: #fafafa;
            cursor: pointer;
            user-select: none;
        }

        .chip.selected {
            background: #f57c00;
            border-color: #f57c00;
            color: #fff;
        }

        .checkbox-row {
            margin-top: 10px;
            font-size: 14px;
        }

        .checkbox-row input {
            margin-right: 6px;
        }

        .file-hint {
            font-size: 12px;
            color: #777;
            margin-top: 4px;
        }

        .button-row {
            margin-top: 22px;
        }

        .fo-gomb {
            background: #f57c00;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 14px 24px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
        }

        .fo-gomb:hover {
            background: #e56f00;
        }

        .back-link {
            text-align: center;
            margin-top: 16px;
            font-size: 14px;
        }

        .back-link a {
            color: #f57c00;
            text-decoration: none;
            font-weight: bold;
        }

        .back-link a:hover {
            text-decoration: underline;
        }

        .footnote {
            margin-top: 18px;
            font-size: 12px;
            color: #777;
            line-height: 1.5;
        }

        .info-text {
            font-size: 12px;
            color: #777;
            margin-top: 4px;
        }

        .dictation-hint {
            font-size: 12px;
            color: #999;
            margin-top: 4px;
            font-style: italic;
        }

        /* √År-√©rdekl≈ëd√©s szekci√≥ */
        .price-mode-row {
            margin-top: 8px;
            font-size: 14px;
        }

        .price-mode-row label {
            display: block;
            margin-bottom: 4px;
        }

        /* Lebeg≈ë adom√°ny / megoszt√°s gomb */
        .floating-donate {
            position: fixed;
            right: 16px;
            bottom: 16px;
            background: #ff9800;
            color: #fff;
            padding: 10px 16px;
            border-radius: 999px;
            font-size: 13px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.3);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            z-index: 9999;
        }

        .floating-donate:hover {
            background: #fb8c00;
        }

        @media (max-width: 640px) {
            .wrapper {
                padding: 20px 15px 25px;
            }
        }
    </style>
</head>
<body>
<!-- [1/3 - END] -->

<!-- [2/3 - START] -->
<div class="wrapper">
    <h1>Munka r√©szletei</h1>
    <p class="alcim">
        Min√©l r√©szletesebben √≠rod le, ann√°l gyorsabban tal√°lsz megfelel≈ë szakembert.
    </p>

    <div class="summary-box" id="summaryBox">
        <div><strong>V√°lasztott szakma:</strong> <span id="sumSzakma">nincs megadva</span></div>
        <div><strong>Helysz√≠n:</strong> <span id="sumHelyszin">nincs megadva</span></div>
        <div><strong>Id≈ëz√≠t√©s:</strong>
            <span id="sumIdozites">leghamarabb: - ‚Ä¢ legk√©s≈ëbb: - ‚Ä¢ hat√°rid≈ë: -</span>
        </div>
        <div><strong>Munka nagys√°ga:</strong> <span id="sumMeret">nincs megadva</span></div>
    </div>

    <!-- 1. r√©sz: r√©szletes le√≠r√°s -->
    <div>
        <div class="section-title">1. A munka r√©szletes le√≠r√°sa</div>
        <div class="section-subtitle">
            √çrd le r√©szletesen a munk√°t
            <strong>(minimum 300 karakter)</strong>.
        </div>

        <div class="textarea-wrapper">
            <!-- Mikrofon gomb -->
            <div id="micButton" class="mic-button" title="Dikt√°l√°s ind√≠t√°sa / le√°ll√≠t√°sa">
                üé§
            </div>

            <textarea id="reszletesLeiras"
                placeholder="Pl.: 40 m¬≤ nappali padl√≥ burkol√°sa, 15 m¬≤ konyha fal csempe, r√©gi burkolat bont√°ssal vagy bont√°s n√©lk√ºl, milyen √°llapot√∫ a fal, milyen burkolatot szeretn√©l, parkol√°s, emelet, lift van-e, stb."></textarea>

            <div id="charCounter" class="char-counter">0 / 300</div>
        </div>

        <div class="info-text">
            Min√©l t√∂bb konkr√©tumot √≠rsz (m¬≤, helyis√©gek, √°llapot, anyagmin≈ës√©g, parkol√°s, szint, lift, stb.),
            ann√°l pontosabb aj√°nlatot kapsz.
        </div>
        <div class="dictation-hint">
            A üé§ gombbal dikt√°lhatsz is (Chrome / Edge t√°mogatott). Ha a b√∂ng√©sz≈ë nem t√°mogatja,
            figyelmeztet√©st kapsz.
        </div>
    </div>

    <!-- 2. r√©sz: szakma-specifikus k√©rd√©sek ‚Äì egyel≈ëre csak inf√≥ -->
    <div>
        <div class="section-title">2. Szakma szerinti plusz k√©rd√©sek</div>
        <div class="section-subtitle">
            A v√°lasztott szakm√°khoz k√©s≈ëbb k√ºl√∂n k√©rd√©ssorokat adunk (m¬≤ fal / padl√≥, bont√°s, anyag vagy csak munkad√≠j, stb.).
            Most egyel≈ëre a fenti r√©szletes le√≠r√°sban √≠rj min√©l t√∂bb konkr√©tumot.
        </div>
    </div>

    <!-- 3. r√©sz: t√∂bb szakma kiv√°laszt√°sa, teljes fel√∫j√≠t√°s -->
    <div>
        <div class="section-title">3. Milyen szakemberek kellenek ehhez a munk√°hoz?</div>
        <div class="section-subtitle">
            V√°lassz ak√°r t√∂bb szakm√°t is (nem k√∂telez≈ë, de aj√°nlott). Ha teljes lak√°sfel√∫j√≠t√°st szeretn√©l, pip√°ld be alul.
        </div>

        <div class="chips-container" id="szakmaChips">
            <div class="chip" data-value="K≈ëm≈±ves">K≈ëm≈±ves</div>
            <div class="chip" data-value="Szobafest≈ë-tap√©t√°z√≥">Szobafest≈ë-tap√©t√°z√≥</div>
            <div class="chip" data-value="Burkol√≥">Burkol√≥</div>
            <div class="chip" data-value="Hidegburkol√≥">Hidegburkol√≥</div>
            <div class="chip" data-value="Melegburkol√≥">Melegburkol√≥</div>
            <div class="chip" data-value="Villanyszerel≈ë">Villanyszerel≈ë</div>
            <div class="chip" data-value="V√≠zszerel≈ë">V√≠zszerel≈ë</div>
            <div class="chip" data-value="G√°zszerel≈ë">G√°zszerel≈ë</div>
            <div class="chip" data-value="F≈±t√©sszerel≈ë">F≈±t√©sszerel≈ë</div>
            <div class="chip" data-value="Gipszkartonos">Gipszkartonos</div>
            <div class="chip" data-value="Kl√≠maszerel≈ë">Kl√≠maszerel≈ë</div>
        </div>

        <div class="checkbox-row">
            <input type="checkbox" id="teljesFelujitas" />
            <label for="teljesFelujitas">
                Teljes lak√°sfel√∫j√≠t√°st szeretn√©k (t√∂bb szakma, teljes projekt).
            </label>
        </div>

        <div class="info-text">
            Ha pl. f√ºrd≈ëfel√∫j√≠t√°st szeretn√©l, jel√∂ld a burkol√≥t, v√≠zszerel≈ët √©s villanyszerel≈ët is.
        </div>
    </div>

    <!-- 4. r√©sz: k√©pfelt√∂lt√©s (demo) -->
    <div>
        <div class="section-title">4. K√©pek a jelenlegi √°llapotr√≥l</div>
        <div class="section-subtitle">
            K√©pek felt√∂lt√©se (nem k√∂telez≈ë, de er≈ësen aj√°nlott).
        </div>

        <input type="file" id="kepek" multiple />
        <div class="file-hint">
            Maximum 10 k√©p, egyenk√©nt legfeljebb ~5 MB. √úgyelj r√°, hogy ne l√°tsz√≥djon szem√©lyes adat
            (arc, n√©v, pontos c√≠m).
        </div>
    </div>

    <!-- 5. r√©sz: √°r-√©rdekl≈ëd√©s, kredit logika el≈ëk√©sz√≠t√©s -->
    <div>
        <div class="section-title">5. √År-√©rdekl≈ëd√©s m√≥dja</div>
        <div class="section-subtitle">
            Itt jelezheted, ha csak az √°rakra vagy k√≠v√°ncsi, vagy t√©nyleg el akarod kezdeni a fel√∫j√≠t√°st.
            K√©s≈ëbb ide ker√ºl a kreditrendszer (√°rk√©r√©s kreditek√©rt, szaki kiemel√©s, stb.).
        </div>

        <div class="price-mode-row">
            <label>
                <input type="radio" name="priceMode" id="modeNormal" value="normal" checked />
                Konkr√©tan meg szeretn√©m csin√°ltatni a munk√°t, nem csak az √°r √©rdekel.
            </label>
            <label>
                <input type="radio" name="priceMode" id="modeOnlyPrice" value="onlyPrice" />
                Csak az √°rakra vagyok k√≠v√°ncsi (t√°j√©koztat√≥ aj√°nlatot k√©rek, szem√©lyes felm√©r√©s n√©lk√ºl).
            </label>
        </div>

        <div class="info-text">
            A v√©gleges rendszerben: ha ‚ÄûCsak az √°rakra vagyok k√≠v√°ncsi‚Äù-t v√°lasztasz, az √°rk√©r√©s kreditet fog fogyasztani.
            A kredit egyik r√©sze a szaki√© (pl. kiemel√©sre), m√°sik r√©sze az oldal m≈±k√∂d√©s√©t t√°mogatja.
        </div>
    </div>

    <!-- Ment√©s gomb + vissza link -->
    <div class="button-row">
        <button class="fo-gomb" onclick="rogzitMunkaDemo()">Munka r√∂gz√≠t√©se (demo)</button>
    </div>

    <div class="back-link">
        ‚Üê <a href="megrendelo-regisztracio.html">Vissza az 1. l√©p√©shez (alapadatok m√≥dos√≠t√°sa)</a>
    </div>

    <div class="footnote">
        A jelen verzi√≥ csak protot√≠pus. A v√©gleges Szaki-App rendszerben a munka el≈ësz√∂r az adminhoz ker√ºl
        j√≥v√°hagy√°sra, csak ezut√°n l√°tj√°k a szakik, l√°tj√°k a szabad nap √°llapot√°t, rangsor√°t, stb.
    </div>
</div>

<!-- Lebeg≈ë adom√°ny / megoszt√°s gomb (dem√≥) -->
<div class="floating-donate" onclick="showDonateInfo()">
    ü§ù <span>Becs√ºletkassza / Megoszt√°s</span>
</div>
<!-- [2/3 - END] -->

<!-- [3/3 - START] -->
<script type="module">
    // Firebase + Firestore bet√∂lt√©se
    import { db } from "./firebase-config.js";
    import {
        collection,
        addDoc,
        serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    // --- LOCALSTORAGE-B√ìL AZ ALAPADATOK BET√ñLT√âSE A S√ÅRGA DOBOZBA ---
    document.addEventListener("DOMContentLoaded", () => {
        const szakma   = localStorage.getItem("mr_szakma")   || "nincs megadva";
        const varos    = localStorage.getItem("mr_varos")    || "nincs megadva";
        const hamar    = localStorage.getItem("mr_kezdes_1") || "-";
        const kesobb   = localStorage.getItem("mr_kezdes_2") || "-";
        const hatarido = localStorage.getItem("mr_hatarido") || "-";
        const meret    = localStorage.getItem("mr_meret")    || "nincs megadva";

        const sumSzakma  = document.getElementById("sumSzakma");
        const sumHelyszin = document.getElementById("sumHelyszin");
        const sumIdozites = document.getElementById("sumIdozites");
        const sumMeret    = document.getElementById("sumMeret");

        if (sumSzakma)  sumSzakma.textContent = szakma;
        if (sumHelyszin) sumHelyszin.textContent = varos;
        if (sumIdozites) sumIdozites.textContent =
            "leghamarabb: " + hamar + " ‚Ä¢ legk√©s≈ëbb: " + kesebb + " ‚Ä¢ hat√°rid≈ë: " + hatarido;
        if (sumMeret)    sumMeret.textContent = meret;
    });

    // Minimum karaktersz√°m a le√≠r√°shoz
    const MIN_LEN = 300;
    const textarea = document.getElementById("reszletesLeiras");
    const counter  = document.getElementById("charCounter");

    // Karaktersz√°ml√°l√≥
    if (textarea && counter) {
        textarea.addEventListener("input", () => {
            const len = textarea.value.length;
            counter.textContent = len + " / " + MIN_LEN;
            if (len < MIN_LEN) {
                counter.classList.add("too-short");
            } else {
                counter.classList.remove("too-short");
            }
        });
    }

    // Szakma chip-ek kapcsolgat√°sa (multi select)
    const chipsContainer = document.getElementById("szakmaChips");
    if (chipsContainer) {
        chipsContainer.addEventListener("click", (e) => {
            const chip = e.target.closest(".chip");
            if (!chip) return;
            chip.classList.toggle("selected");
        });
    }

    // Dikt√°l√°s gomb ‚Äì egyel≈ëre csak demo √ºzenet
    const micButton = document.getElementById("micButton");
    if (micButton) {
        micButton.addEventListener("click", () => {
            alert(
                "A dikt√°l√°s funkci√≥ hamarosan √©rkezik! üé§\n\n" +
                "Most m√©g g√©pelni kell, de a v√©gleges verzi√≥ban ide tudsz majd besz√©lni."
            );
        });
    }

    // Becs√ºletkassza / Megoszt√°s lebeg≈ë gomb
    function showDonateInfo() {
        alert(
            "Becs√ºletkassza / megoszt√°s √∂tlete (PROTOT√çPUS):\n\n" +
            "‚Ä¢ Ha hasznosnak √©rzed az oldalt, megoszthatod Facebookon, Inst√°n, stb.\n" +
            "‚Ä¢ K√©s≈ëbb lesz lehet≈ës√©g √∂nk√©ntes t√°mogat√°sra is (pl. p√°r sz√°z forinttal),\n" +
            "  cser√©be extra funkci√≥kat kaphatsz (szaki kiemel√©s, gyorsabb aj√°nlat, stb.)."
        );
    }
    window.showDonateInfo = showDonateInfo;

    // Munka ment√©se Firestore-ba (DEMO)
    async function rogzitMunkaDemo() {
        const leiras = textarea ? textarea.value.trim() : "";

        if (leiras.length < MIN_LEN) {
            alert(
                "K√©rlek √≠rj legal√°bb " +
                MIN_LEN +
                " karakteres le√≠r√°st a munk√°r√≥l.\n\n" +
                "Min√©l r√©szletesebb, ann√°l pontosabb aj√°nlatot kapsz."
            );
            return;
        }

        // Kiv√°lasztott szakm√°k (chip-ek)
        const selectedChips = Array.from(
            document.querySelectorAll(".chip.selected")
        ).map(chip => chip.getAttribute("data-value"));

        // Teljes lak√°sfel√∫j√≠t√°s pip√°ja
        const teljes = document.getElementById("teljesFelujitas")?.checked || false;

        // √År-√©rdekl≈ëd√©s m√≥dja (radio gombok)
        const modeInput = document.querySelector('input[name="priceMode"]:checked');
        const arMode = modeInput ? modeInput.value : "ismeretlen";

        // 1. l√©p√©sb≈ël √°thozott adatok (ha elmentett√ºk localStorage-ba)
        const nev      = localStorage.getItem("mr_nev")      || "ismeretlen n√©v";
        const varos    = localStorage.getItem("mr_varos")    || "ismeretlen helysz√≠n";
        const elerhet  = localStorage.getItem("mr_elerhetoseg") || "nincs el√©rhet≈ës√©g";
        const szakma   = localStorage.getItem("mr_szakma")   || "nincs megadva";
        const hamar    = localStorage.getItem("mr_kezdes_1") || "-";
        const kesobb   = localStorage.getItem("mr_kezdes_2") || "-";
        const hatarido = localStorage.getItem("mr_hatarido") || "-";
        const meret    = localStorage.getItem("mr_meret")    || "nincs megadva";

        const workData = {
            // Kapcsolat
            customerName: nev,
            location: varos,
            contact: elerhet,

            // Alapadatok
            mainTrade: szakma,
            startEarliest: hamar,
            startLatest: kesobb,
            deadline: hatarido,
            workSize: meret,

            // R√©szletek
            description: leiras,
            trades: selectedChips,
            fullRenovation: teljes,
            priceInterestMode: arMode,   // "normal" / "onlyPrice"

            createdAt: serverTimestamp()
        };

        try {
            const docRef = await addDoc(collection(db, "workRequests"), workData);

            alert(
                "K√∂sz√∂n√∂m! A munkale√≠r√°sodat elmentett√ºk a rendszerbe. ‚úÖ\n\n" +
                "Ez most m√©g PROTOT√çPUS: a v√©gleges Szaki-Appben innen indul majd a szakik √©rtes√≠t√©se.\n\n" +
                "Mentett azonos√≠t√≥ (Firestore): " + docRef.id
            );
        } catch (error) {
            console.error("Firestore ment√©si hiba:", error);
            alert(
                "Hopp√°, valami hiba t√∂rt√©nt a ment√©sn√©l. üòï\n\n" +
                "Ellen≈ërizd az internetkapcsolatot, √©s pr√≥b√°ld meg k√©s≈ëbb √∫jra."
            );
        }
    }

    // Gombhoz k√∂tj√ºk a ment≈ë f√ºggv√©nyt
    window.rogzitMunkaDemo = rogzitMunkaDemo;
</script>
<!-- [3/3 - END] -->
</body>
</html>
